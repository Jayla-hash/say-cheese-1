(function(y){"object"===typeof exports&&"undefined"!==typeof module?module.exports=y():"function"===typeof define&&define.amd?define([],y):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=y()})(function(){return function g(k,m,d){function b(c,f){if(!m[c]){if(!k[c]){var e="function"==typeof require&&require;if(!f&&e)return e(c,!0);if(a)return a(c,!0);e=Error("Cannot find module '"+c+"'");throw e.code="MODULE_NOT_FOUND",e;}e=m[c]={exports:{}};
k[c][0].call(e.exports,function(a){var f=k[c][1][a];return b(f?f:a)},e,e.exports,g,k,m,d)}return m[c].exports}for(var a="function"==typeof require&&require,c=0;c<d.length;c++)b(d[c]);return b}({1:[function(g,k,m){m=g("./utils").log;var d=g("./utils").browserDetails;k.exports.browserDetails=d;k.exports.extractVersion=g("./utils").extractVersion;k.exports.disableLog=g("./utils").disableLog;g("./utils").disableLog(!0);var b=g("./chrome/chrome_shim")||null,a=g("./edge/edge_shim")||null,c=g("./firefox/firefox_shim")||
null;g=g("./safari/safari_shim")||null;switch(d.browser){case "opera":case "chrome":if(!b||!b.shimPeerConnection){m("Chrome shim is not included in this adapter release.");break}m("adapter.js shimming chrome.");k.exports.browserShim=b;b.shimGetUserMedia();b.shimSourceObject();b.shimPeerConnection();b.shimOnTrack();break;case "firefox":if(!c||!c.shimPeerConnection){m("Firefox shim is not included in this adapter release.");break}m("adapter.js shimming firefox.");k.exports.browserShim=c;c.shimGetUserMedia();
c.shimSourceObject();c.shimPeerConnection();c.shimOnTrack();break;case "edge":if(!a||!a.shimPeerConnection){m("MS edge shim is not included in this adapter release.");break}m("adapter.js shimming edge.");k.exports.browserShim=a;a.shimPeerConnection();break;case "safari":if(!g){m("Safari shim is not included in this adapter release.");break}m("adapter.js shimming safari.");k.exports.browserShim=g;g.shimGetUserMedia();break;default:m("Unsupported browser!")}},{"./chrome/chrome_shim":2,"./edge/edge_shim":5,
"./firefox/firefox_shim":6,"./safari/safari_shim":8,"./utils":9}],2:[function(g,k,m){var d=g("../utils.js").log,b=g("../utils.js").browserDetails;k.exports={shimOnTrack:function(){"object"!==typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){var c=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",
this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.addEventListener("addtrack",function(b){var d=new Event("track");d.track=b.track;d.receiver={track:b.track};d.streams=[a.stream];c.dispatchEvent(d)});a.stream.getTracks().forEach(function(c){var b=new Event("track");b.track=c;b.receiver={track:c};b.streams=[a.stream];this.dispatchEvent(b)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"===typeof window&&
(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var c=this;this._srcObject=a;this.src&&URL.revokeObjectURL(this.src);a?(this.src=URL.createObjectURL(a),a.addEventListener("addtrack",function(){c.src&&URL.revokeObjectURL(c.src);c.src=URL.createObjectURL(a)}),a.addEventListener("removetrack",function(){c.src&&URL.revokeObjectURL(c.src);c.src=URL.createObjectURL(a)})):
this.src=""}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(a,c){d("PeerConnection");a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);var h=new webkitRTCPeerConnection(a,c),b=h.getStats.bind(h);h.getStats=function(a,c,h){var d=this,p=arguments;if(0<arguments.length&&"function"===typeof a)return b(a,c);var r=function(a){var c={};a.result().forEach(function(a){var h={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(c){h[c]=a.stat(c)});c[h.id]=
h});return c};return 2<=arguments.length?b.apply(this,[function(a){p[1](r(a))},arguments[0]]):new Promise(function(c,h){1===p.length&&"object"===typeof a?b.apply(d,[function(a){c.apply(null,[r(a)])},h]):b.apply(d,[c,h])})};return h};window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype;webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}});["createOffer",
"createAnswer"].forEach(function(a){var c=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,n){c.apply(a,[d,n,b])})}return c.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var c=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=
function(){var h=arguments,b=this;h[0]=new ("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(h[0]);return new Promise(function(a,d){c.apply(b,[h[0],function(){a();2<=h.length&&h[1].apply(null,[])},function(a){d(a);3<=h.length&&h[2].apply(null,[a])}])})}})},shimGetUserMedia:g("./getusermedia"),attachMediaStream:function(a,c){d("DEPRECATED, attachMediaStream will soon be removed.");43<=b.version?a.srcObject=c:"undefined"!==typeof a.src?a.src=URL.createObjectURL(c):d("Error attaching stream to element.")},
reattachMediaStream:function(a,c){d("DEPRECATED, reattachMediaStream will soon be removed.");43<=b.version?a.srcObject=c.srcObject:a.src=c.src}}},{"../utils.js":9,"./getusermedia":3}],3:[function(g,k,m){var d=g("../utils.js").log;k.exports=function(){var b=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;var c={};Object.keys(a).forEach(function(b){if("require"!==b&&"advanced"!==b&&"mediaSource"!==b){var d="object"===typeof a[b]?a[b]:{ideal:a[b]};void 0!==d.exact&&"number"===typeof d.exact&&
(d.min=d.max=d.exact);var q=function(a,c){return a?a+c.charAt(0).toUpperCase()+c.slice(1):"deviceId"===c?"sourceId":c};if(void 0!==d.ideal){c.optional=c.optional||[];var l={};"number"===typeof d.ideal?(l[q("min",b)]=d.ideal,c.optional.push(l),l={},l[q("max",b)]=d.ideal):l[q("",b)]=d.ideal;c.optional.push(l)}void 0!==d.exact&&"number"!==typeof d.exact?(c.mandatory=c.mandatory||{},c.mandatory[q("",b)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(c.mandatory=c.mandatory||{},c.mandatory[q(a,
b)]=d[a])})}});a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced));return c};navigator.getUserMedia=function(a,c,e){a=JSON.parse(JSON.stringify(a));a.audio&&(a.audio=b(a.audio));a.video&&(a.video=b(a.video));d("chrome: "+JSON.stringify(a));return navigator.webkitGetUserMedia(a,c,e)};var a=function(a){return new Promise(function(c,b){navigator.getUserMedia(a,c,b)})};navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,enumerateDevices:function(){return new Promise(function(a){var c=
{audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(b){a(b.map(function(a){return{label:a.label,kind:c[a.kind],deviceId:a.id,groupId:""}}))})})}});if(navigator.mediaDevices.getUserMedia){var c=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){a&&(d("spec:   "+JSON.stringify(a)),a.audio=b(a.audio),a.video=b(a.video),d("chrome: "+JSON.stringify(a)));return c(a)}.bind(this)}else navigator.mediaDevices.getUserMedia=
function(c){return a(c)};"undefined"===typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){d("Dummy mediaDevices.addEventListener called.")});"undefined"===typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){d("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":9}],4:[function(g,k,m){var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=
d.generateIdentifier();d.splitLines=function(b){return b.trim().split("\n").map(function(a){return a.trim()})};d.splitSections=function(b){return b.split("\nm=").map(function(a,c){return(0<c?"m="+a:a).trim()+"\r\n"})};d.matchPrefix=function(b,a){return d.splitLines(b).filter(function(c){return 0===c.indexOf(a)})};d.parseCandidate=function(b){b=0===b.indexOf("a=candidate:")?b.substring(12).split(" "):b.substring(10).split(" ");for(var a={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:parseInt(b[3],
10),ip:b[4],port:parseInt(b[5],10),type:b[7]},c=8;c<b.length;c+=2)switch(b[c]){case "raddr":a.relatedAddress=b[c+1];break;case "rport":a.relatedPort=parseInt(b[c+1],10);break;case "tcptype":a.tcpType=b[c+1]}return a};d.writeCandidate=function(b){var a=[];a.push(b.foundation);a.push(b.component);a.push(b.protocol.toUpperCase());a.push(b.priority);a.push(b.ip);a.push(b.port);var c=b.type;a.push("typ");a.push(c);"host"!==c&&b.relatedAddress&&b.relatedPort&&(a.push("raddr"),a.push(b.relatedAddress),a.push("rport"),
a.push(b.relatedPort));b.tcpType&&"tcp"===b.protocol.toLowerCase()&&(a.push("tcptype"),a.push(b.tcpType));return"candidate:"+a.join(" ")};d.parseRtpMap=function(b){b=b.substr(9).split(" ");var a={payloadType:parseInt(b.shift(),10)};b=b[0].split("/");a.name=b[0];a.clockRate=parseInt(b[1],10);a.numChannels=3===b.length?parseInt(b[2],10):1;return a};d.writeRtpMap=function(b){var a=b.payloadType;void 0!==b.preferredPayloadType&&(a=b.preferredPayloadType);return"a=rtpmap:"+a+" "+b.name+"/"+b.clockRate+
(1!==b.numChannels?"/"+b.numChannels:"")+"\r\n"};d.parseExtmap=function(b){b=b.substr(9).split(" ");return{id:parseInt(b[0],10),uri:b[1]}};d.writeExtmap=function(b){return"a=extmap:"+(b.id||b.preferredId)+" "+b.uri+"\r\n"};d.parseFmtp=function(b){for(var a={},c=b.substr(b.indexOf(" ")+1).split(";"),h=0;h<c.length;h++)b=c[h].trim().split("="),a[b[0].trim()]=b[1];return a};d.writeFmtp=function(b){var a="",c=b.payloadType;void 0!==b.preferredPayloadType&&(c=b.preferredPayloadType);if(b.parameters&&Object.keys(b.parameters).length){var h=
[];Object.keys(b.parameters).forEach(function(a){h.push(a+"="+b.parameters[a])});a+="a=fmtp:"+c+" "+h.join(";")+"\r\n"}return a};d.parseRtcpFb=function(b){b=b.substr(b.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}};d.writeRtcpFb=function(b){var a="",c=b.payloadType;void 0!==b.preferredPayloadType&&(c=b.preferredPayloadType);b.rtcpFeedback&&b.rtcpFeedback.length&&b.rtcpFeedback.forEach(function(b){a+="a=rtcp-fb:"+c+" "+b.type+" "+b.parameter+"\r\n"});return a};d.parseSsrcMedia=
function(b){var a=b.indexOf(" "),c={ssrc:parseInt(b.substr(7,a-7),10)},h=b.indexOf(":",a);-1<h?(c.attribute=b.substr(a+1,h-a-1),c.value=b.substr(h+1)):c.attribute=b.substr(a+1);return c};d.getDtlsParameters=function(b,a){var c=d.splitLines(b),c=c.concat(d.splitLines(a)),c=c.filter(function(a){return 0===a.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:c.split(" ")[0],value:c.split(" ")[1]}]}};d.writeDtlsParameters=function(b,a){var c="a=setup:"+a+"\r\n";b.fingerprints.forEach(function(a){c+=
"a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"});return c};d.getIceParameters=function(b,a){var c=d.splitLines(b),c=c.concat(d.splitLines(a));return{usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)}};d.writeIceParameters=function(b){return"a=ice-ufrag:"+b.usernameFragment+"\r\na=ice-pwd:"+b.password+"\r\n"};d.parseRtpParameters=function(b){for(var a={codecs:[],headerExtensions:[],
fecMechanisms:[],rtcp:[]},c=d.splitLines(b)[0].split(" "),h=3;h<c.length;h++){var f=c[h],e=d.matchPrefix(b,"a=rtpmap:"+f+" ")[0];if(e){var e=d.parseRtpMap(e),n=d.matchPrefix(b,"a=fmtp:"+f+" ");e.parameters=n.length?d.parseFmtp(n[0]):{};e.rtcpFeedback=d.matchPrefix(b,"a=rtcp-fb:"+f+" ").map(d.parseRtcpFb);a.codecs.push(e);switch(e.name.toUpperCase()){case "RED":case "ULPFEC":a.fecMechanisms.push(e.name.toUpperCase())}}}d.matchPrefix(b,"a=extmap:").forEach(function(c){a.headerExtensions.push(d.parseExtmap(c))});
return a};d.writeRtpDescription=function(b,a){var c="",c=c+("m="+b+" "),c=c+(0<a.codecs.length?"9":"0"),c=c+" UDP/TLS/RTP/SAVPF ",c=c+(a.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n"),c=c+"c=IN IP4 0.0.0.0\r\n",c=c+"a=rtcp:9 IN IP4 0.0.0.0\r\n";a.codecs.forEach(function(a){c+=d.writeRtpMap(a);c+=d.writeFmtp(a);c+=d.writeRtcpFb(a)});return c+="a=rtcp-mux\r\n"};d.parseRtpEncodingParameters=function(b){var a=[],c=d.parseRtpParameters(b),
h=-1!==c.fecMechanisms.indexOf("RED"),f=-1!==c.fecMechanisms.indexOf("ULPFEC"),e=d.matchPrefix(b,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),n=0<e.length&&e[0].ssrc,q,e=d.matchPrefix(b,"a=ssrc-group:FID").map(function(a){a=a.split(" ");a.shift();return a.map(function(a){return parseInt(a,10)})});0<e.length&&1<e[0].length&&e[0][0]===n&&(q=e[0][1]);c.codecs.forEach(function(c){"RTX"===c.name.toUpperCase()&&c.parameters.apt&&(c={ssrc:n,codecPayloadType:parseInt(c.parameters.apt,
10),rtx:{ssrc:q}},a.push(c),h&&(c=JSON.parse(JSON.stringify(c)),c.fec={ssrc:q,mechanism:f?"red+ulpfec":"red"},a.push(c)))});0===a.length&&n&&a.push({ssrc:n});var l=d.matchPrefix(b,"b=");l.length&&(0===l[0].indexOf("b=TIAS:")?l=parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")&&(l=parseInt(l[0].substr(5),10)),a.forEach(function(a){a.maxBitrate=l}));return a};d.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};d.writeMediaSection=
function(b,a,c,h){a=d.writeRtpDescription(b.kind,a);a+=d.writeIceParameters(b.iceGatherer.getLocalParameters());a+=d.writeDtlsParameters(b.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active");a+="a=mid:"+b.mid+"\r\n";a=b.rtpSender&&b.rtpReceiver?a+"a=sendrecv\r\n":b.rtpSender?a+"a=sendonly\r\n":b.rtpReceiver?a+"a=recvonly\r\n":a+"a=inactive\r\n";b.rtpSender&&(c="msid:"+h.id+" "+b.rtpSender.track.id+"\r\n",a=a+("a="+c)+("a=ssrc:"+b.sendEncodingParameters[0].ssrc+" "+c));return a+="a=ssrc:"+
b.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n"};d.getDirection=function(b,a){for(var c=d.splitLines(b),h=0;h<c.length;h++)switch(c[h]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return c[h].substr(2)}return a?d.getDirection(a):"sendrecv"};k.exports=d},{}],5:[function(g,k,m){var d=g("./edge_sdp"),b=g("../utils").log;k.exports={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a}),window.RTCSessionDescription||
(window.RTCSessionDescription=function(a){return a}));window.RTCPeerConnection=function(a){var c=this,b=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){c[a]=b[a].bind(b)});this.ondatachannel=this.onnegotiationneeded=this.oniceconnectionstatechange=this.onsignalingstatechange=this.onremovestream=this.ontrack=this.onaddstream=this.onicecandidate=null;this.localStreams=[];this.remoteStreams=[];this.getLocalStreams=function(){return c.localStreams};
this.getRemoteStreams=function(){return c.remoteStreams};this.localDescription=new RTCSessionDescription({type:"",sdp:""});this.remoteDescription=new RTCSessionDescription({type:"",sdp:""});this.signalingState="stable";this.iceGatheringState=this.iceConnectionState="new";this.iceOptions={gatherPolicy:"all",iceServers:[]};if(a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case "all":case "relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case "none":throw new TypeError('iceTransportPolicy "none" not supported');
}a&&a.iceServers&&(this.iceOptions.iceServers=a.iceServers.filter(function(a){return a&&a.urls?(a.urls=a.urls.filter(function(a){return 0===a.indexOf("turn:")&&-1!==a.indexOf("transport=udp")})[0],!!a.urls):!1}));this.transceivers=[];this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this,c=d.splitSections(a.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(b){if(b.candidate&&0!==Object.keys(b.candidate).length)-1===b.candidate.candidate.indexOf("typ endOfCandidates")&&
(c[b.candidate.sdpMLineIndex+1]+="a="+b.candidate.candidate+"\r\n");else for(var d=1;d<c.length;d++)-1===c[d].indexOf("\r\na=end-of-candidates\r\n")&&(c[d]+="a=end-of-candidates\r\n");a.localDescription.sdp=c.join("");a.dispatchEvent(b);if(null!==a.onicecandidate)a.onicecandidate(b);!b.candidate&&"complete"!==a.iceGatheringState&&a.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state})&&(a.iceGatheringState="complete")});this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype.addStream=
function(a){this.localStreams.push(a.clone());this._maybeFireNegotiationNeeded()};window.RTCPeerConnection.prototype.removeStream=function(a){a=this.localStreams.indexOf(a);-1<a&&(this.localStreams.splice(a,1),this._maybeFireNegotiationNeeded())};window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,c){var b={codecs:[],headerExtensions:[],fecMechanisms:[]};a.codecs.forEach(function(a){for(var d=0;d<c.codecs.length;d++){var n=c.codecs[d];if(a.name.toLowerCase()===n.name.toLowerCase()&&
a.clockRate===n.clockRate&&a.numChannels===n.numChannels){b.codecs.push(n);break}}});a.headerExtensions.forEach(function(a){for(var d=0;d<c.headerExtensions.length;d++){var n=c.headerExtensions[d];if(a.uri===n.uri){b.headerExtensions.push(n);break}}});return b};window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,c){var b=this,f=new RTCIceGatherer(b.iceOptions),e=new RTCIceTransport(f);f.onlocalcandidate=function(q){var l=new Event("icecandidate");l.candidate={sdpMid:a,sdpMLineIndex:c};
var p=q.candidate;(q=!p||0===Object.keys(p).length)?(void 0===f.state&&(f.state="completed"),l.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(p.component="RTCP"===e.component?2:1,l.candidate.candidate=d.writeCandidate(p));p=b.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});switch(b.iceGatheringState){case "new":b._localIceCandidatesBuffer.push(l);q&&p&&b._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case "gathering":b._emitBufferedCandidates();
b.dispatchEvent(l);if(null!==b.onicecandidate)b.onicecandidate(l);if(p){b.dispatchEvent(new Event("icecandidate"));if(null!==b.onicecandidate)b.onicecandidate(new Event("icecandidate"));b.iceGatheringState="complete"}}};e.onicestatechange=function(){b._updateConnectionState()};var n=new RTCDtlsTransport(e);n.ondtlsstatechange=function(){b._updateConnectionState()};n.onerror=function(){n.state="failed";b._updateConnectionState()};return{iceGatherer:f,iceTransport:e,dtlsTransport:n}};window.RTCPeerConnection.prototype._transceive=
function(a,c,b){var f=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(f.encodings=a.sendEncodingParameters,f.rtcp={cname:d.localCName},a.recvEncodingParameters.length&&(f.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(f));b&&a.rtpReceiver&&(f.encodings=a.recvEncodingParameters,f.rtcp={cname:a.cname},a.sendEncodingParameters.length&&(f.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(f))};window.RTCPeerConnection.prototype.setLocalDescription=
function(a){var c=this,b,f;"offer"===a.type?this._pendingOffer&&(b=d.splitSections(a.sdp),f=b.shift(),b.forEach(function(a,b){var h=d.parseRtpParameters(a);c._pendingOffer[b].localCapabilities=h}),this.transceivers=this._pendingOffer,delete this._pendingOffer):"answer"===a.type&&(b=d.splitSections(c.remoteDescription.sdp),f=b.shift(),b.forEach(function(a,b){var h=c.transceivers[b],e=h.iceGatherer,n=h.iceTransport,g=h.dtlsTransport,k=h.localCapabilities,m=h.remoteCapabilities;if("0"!==a.split("\n",
1)[0].split(" ",2)[1]){var t=d.getIceParameters(a,f);n.start(e,t,"controlled");e=d.getDtlsParameters(a,f);g.start(e);g=c._getCommonCapabilities(k,m);c._transceive(h,0<g.codecs.length,!1)}}));this.localDescription={type:a.type,sdp:a.sdp};switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}var e=1<arguments.length&&"function"===typeof arguments[1];if(e){var n=
arguments[1];window.setTimeout(function(){n();"new"===c.iceGatheringState&&(c.iceGatheringState="gathering");c._emitBufferedCandidates()},0)}b=Promise.resolve();b.then(function(){e||("new"===c.iceGatheringState&&(c.iceGatheringState="gathering"),window.setTimeout(c._emitBufferedCandidates.bind(c),500))});return b};window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var c=this,b=new MediaStream,f=[],e=d.splitSections(a.sdp),n=e.shift();e.forEach(function(e,l){var p=d.splitLines(e)[0].substr(2).split(" "),
r=p[0],g="0"===p[1],p=d.getDirection(e,n),k,m,B,t,v,x,z,w,C=d.parseRtpParameters(e),u;g||(u=d.getIceParameters(e,n),w=d.getDtlsParameters(e,n));x=d.parseRtpEncodingParameters(e);k=d.matchPrefix(e,"a=mid:");k=k.length?k[0].substr(6):d.generateIdentifier();var A;if(v=d.matchPrefix(e,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0])A=v.value;var D=0<d.matchPrefix(e,"a=end-of-candidates").length,E=d.matchPrefix(e,"a=candidate:").map(function(a){return d.parseCandidate(a)}).filter(function(a){return"1"===
a.component});"offer"!==a.type||g?"answer"!==a.type||g||(r=c.transceivers[l],k=r.iceGatherer,m=r.iceTransport,B=r.dtlsTransport,t=r.rtpSender,g=r.rtpReceiver,v=r.sendEncodingParameters,z=r.localCapabilities,c.transceivers[l].recvEncodingParameters=x,c.transceivers[l].remoteCapabilities=C,c.transceivers[l].cname=A,D&&m.setRemoteCandidates(E),m.start(k,u,"controlling"),B.start(w),c._transceive(r,"sendrecv"===p||"recvonly"===p,"sendrecv"===p||"sendonly"===p),!g||"sendrecv"!==p&&"sendonly"!==p?delete r.rtpReceiver:
(w=g.track,f.push([w,g]),b.addTrack(w))):(u=c._createIceAndDtlsTransports(k,l),D&&u.iceTransport.setRemoteCandidates(E),z=RTCRtpReceiver.getCapabilities(r),v=[{ssrc:1001*(2*l+2)}],g=new RTCRtpReceiver(u.dtlsTransport,r),w=g.track,f.push([w,g]),b.addTrack(w),0<c.localStreams.length&&c.localStreams[0].getTracks().length>=l&&(t=c.localStreams[0].getTracks()[l],t=new RTCRtpSender(t,u.dtlsTransport)),c.transceivers[l]={iceGatherer:u.iceGatherer,iceTransport:u.iceTransport,dtlsTransport:u.dtlsTransport,
localCapabilities:z,remoteCapabilities:C,rtpSender:t,rtpReceiver:g,kind:r,mid:k,cname:A,sendEncodingParameters:v,recvEncodingParameters:x},c._transceive(c.transceivers[l],!1,"sendrecv"===p||"sendonly"===p))});this.remoteDescription={type:a.type,sdp:a.sdp};switch(a.type){case "offer":this._updateSignalingState("have-remote-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}b.getTracks().length&&(c.remoteStreams.push(b),
window.setTimeout(function(){var a=new Event("addstream");a.stream=b;c.dispatchEvent(a);null!==c.onaddstream&&window.setTimeout(function(){c.onaddstream(a)},0);f.forEach(function(d){var e=d[0];d=d[1];var f=new Event("track");f.track=e;f.receiver=d;f.streams=[b];c.dispatchEvent(a);null!==c.ontrack&&window.setTimeout(function(){c.ontrack(f)},0)})},0));1<arguments.length&&"function"===typeof arguments[1]&&window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.close=
function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._updateSignalingState("closed")};window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this.dispatchEvent(a);if(null!==this.onsignalingstatechange)this.onsignalingstatechange(a)};window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=
function(){var a=new Event("negotiationneeded");this.dispatchEvent(a);if(null!==this.onnegotiationneeded)this.onnegotiationneeded(a)};window.RTCPeerConnection.prototype._updateConnectionState=function(){var a,c={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};this.transceivers.forEach(function(a){c[a.iceTransport.state]++;c[a.dtlsTransport.state]++});c.connected+=c.completed;a="new";if(0<c.failed)a="failed";else if(0<c.connecting||0<c.checking)a="connecting";else if(0<c.disconnected)a=
"disconnected";else if(0<c["new"])a="new";else if(0<c.connected||0<c.completed)a="connected";if(a!==this.iceConnectionState&&(this.iceConnectionState=a,a=new Event("iceconnectionstatechange"),this.dispatchEvent(a),null!==this.oniceconnectionstatechange))this.oniceconnectionstatechange(a)};window.RTCPeerConnection.prototype.createOffer=function(){var a=this;if(this._pendingOffer)throw Error("createOffer called while there is a pending offer.");var c;1===arguments.length&&"function"!==typeof arguments[0]?
c=arguments[0]:3===arguments.length&&(c=arguments[2]);var b=[],f=0,e=0;this.localStreams.length&&(f=this.localStreams[0].getAudioTracks().length,e=this.localStreams[0].getVideoTracks().length);if(c){if(c.mandatory||c.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==c.offerToReceiveAudio&&(f=c.offerToReceiveAudio);void 0!==c.offerToReceiveVideo&&(e=c.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){b.push({kind:a.kind,
track:a,wantReceive:"audio"===a.kind?0<f:0<e});"audio"===a.kind?f--:"video"===a.kind&&e--});0<f||0<e;)0<f&&(b.push({kind:"audio",wantReceive:!0}),f--),0<e&&(b.push({kind:"video",wantReceive:!0}),e--);var g=d.writeSessionBoilerplate(),q=[];b.forEach(function(c,b){var h=c.track,f=c.kind,e=d.generateIdentifier(),k=a._createIceAndDtlsTransports(e,b),m=RTCRtpSender.getCapabilities(f),t,v,x=[{ssrc:1001*(2*b+1)}];h&&(t=new RTCRtpSender(h,k.dtlsTransport));c.wantReceive&&(v=new RTCRtpReceiver(k.dtlsTransport,
f));q[b]={iceGatherer:k.iceGatherer,iceTransport:k.iceTransport,dtlsTransport:k.dtlsTransport,localCapabilities:m,remoteCapabilities:null,rtpSender:t,rtpReceiver:v,kind:f,mid:e,sendEncodingParameters:x,recvEncodingParameters:null};h=q[b];g+=d.writeMediaSection(h,h.localCapabilities,"offer",a.localStreams[0])});this._pendingOffer=q;c=new RTCSessionDescription({type:"offer",sdp:g});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,c);return Promise.resolve(c)};window.RTCPeerConnection.prototype.createAnswer=
function(){var a=this,c=d.writeSessionBoilerplate();this.transceivers.forEach(function(b){var h=a._getCommonCapabilities(b.localCapabilities,b.remoteCapabilities);c+=d.writeMediaSection(b,h,"answer",a.localStreams[0])});var b=new RTCSessionDescription({type:"answer",sdp:c});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,b);return Promise.resolve(b)};window.RTCPeerConnection.prototype.addIceCandidate=function(a){var c=a.sdpMLineIndex;if(a.sdpMid)for(var b=0;b<
this.transceivers.length;b++)if(this.transceivers[b].mid===a.sdpMid){c=b;break}var f=this.transceivers[c];if(f){b=0<Object.keys(a.candidate).length?d.parseCandidate(a.candidate):{};if("tcp"===b.protocol&&0===b.port||"1"!==b.component)return;"endOfCandidates"===b.type&&(b={});f.iceTransport.addRemoteCandidate(b);f=d.splitSections(this.remoteDescription.sdp);f[c+1]+=(b.type?a.candidate.trim():"a=end-of-candidates")+"\r\n";this.remoteDescription.sdp=f.join("")}1<arguments.length&&"function"===typeof arguments[1]&&
window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(c){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){c[b]&&a.push(c[b].getStats())})});var c=1<arguments.length&&"function"===typeof arguments[1]&&arguments[1];return new Promise(function(b){var d={};Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(c){d[c]=a[c]})});
c&&window.setTimeout(c,0,d);b(d)})})}},attachMediaStream:function(a,c){b("DEPRECATED, attachMediaStream will soon be removed.");a.srcObject=c},reattachMediaStream:function(a,c){b("DEPRECATED, reattachMediaStream will soon be removed.");a.srcObject=c.srcObject}}},{"../utils":9,"./edge_sdp":4}],6:[function(g,k,m){var d=g("../utils").log,b=g("../utils").browserDetails;k.exports={shimOnTrack:function(){"object"!==typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||
Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var d=new Event("track");d.track=b;d.receiver={track:b};d.streams=[a.stream];this.dispatchEvent(d)}.bind(this))}.bind(this))}})},
shimSourceObject:function(){"object"===typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(){window.RTCPeerConnection||(window.RTCPeerConnection=function(a,c){if(38>b.version&&a&&a.iceServers){for(var d=[],f=0;f<a.iceServers.length;f++){var e=a.iceServers[f];if(e.hasOwnProperty("urls"))for(var g=
0;g<e.urls.length;g++){var k={url:e.urls[g]};0===e.urls[g].indexOf("turn")&&(k.username=e.username,k.credential=e.credential);d.push(k)}else d.push(a.iceServers[f])}a.iceServers=d}return new mozRTCPeerConnection(a,c)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,
window.RTCIceCandidate=mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=RTCPeerConnection.prototype[a];RTCPeerConnection.prototype[a]=function(){arguments[0]=new ("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]);return b.apply(this,arguments)}})},shimGetUserMedia:g("./getusermedia"),attachMediaStream:function(a,b){d("DEPRECATED, attachMediaStream will soon be removed.");a.srcObject=b},reattachMediaStream:function(a,
b){d("DEPRECATED, reattachMediaStream will soon be removed.");a.srcObject=b.srcObject}}},{"../utils":9,"./getusermedia":7}],7:[function(g,k,m){var d=g("../utils").log,b=g("../utils").browserDetails;k.exports=function(){navigator.getUserMedia=function(a,c,e){var g=function(a){if("object"!==typeof a||a.require)return a;var b=[];Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0===d.min&&void 0===d.max&&void 0===
d.exact||b.push(c);void 0!==d.exact&&("number"===typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact);if(void 0!==d.ideal){a.advanced=a.advanced||[];var e={};e[c]="number"===typeof d.ideal?{min:d.ideal,max:d.ideal}:d.ideal;a.advanced.push(e);delete d.ideal;Object.keys(d).length||delete a[c]}}});b.length&&(a.require=b);return a};a=JSON.parse(JSON.stringify(a));38>b.version&&(d("spec: "+JSON.stringify(a)),a.audio&&(a.audio=g(a.audio)),a.video&&(a.video=g(a.video)),d("ff37: "+JSON.stringify(a)));
return navigator.mozGetUserMedia(a,c,e)};var a=function(a){return new Promise(function(b,c){navigator.getUserMedia(a,b,c)})};navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,addEventListener:function(){},removeEventListener:function(){}});navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};
if(41>b.version){var c=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;})}}}},{"../utils":9}],8:[function(g,k,m){k.exports={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}}},{}],9:[function(g,k,m){var d=!1,b={disableLog:function(a){return"boolean"!==typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):
(d=a)?"adapter.js logging disabled":"adapter.js logging enabled"},log:function(){"object"!==typeof window||d||"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)},extractVersion:function(a,b,d){return(a=a.match(b))&&a.length>=d&&parseInt(a[d],10)},detectBrowser:function(){var a={browser:null,version:null,minVersion:null};if("undefined"===typeof window||!window.navigator)return a.browser="Not a browser.",a;if(navigator.mozGetUserMedia)a.browser="firefox",
a.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),a.minVersion=31;else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)a.browser="chrome",a.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),a.minVersion=38;else if(navigator.userAgent.match(/Version\/(\d+).(\d+)/))a.browser="safari",a.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1),a.minVersion=602;else return a.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",
a;else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))a.browser="edge",a.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),a.minVersion=10547;else return a.browser="Not a supported browser.",a;a.version<a.minVersion&&b.log("Browser: "+a.browser+" Version: "+a.version+" < minimum supported version: "+a.minVersion+"\n some things might not work!");return a}};k.exports={log:b.log,disableLog:b.disableLog,browserDetails:b.detectBrowser(),extractVersion:b.extractVersion}},
{}]},{},[1])(1)});
(function(b,k){b.fn.outerHTML||b.extend(b.fn,{outerHTML:function(){return b("<div>").append(this.clone()).html()}});b.fn.inDOM||b.extend(b.fn,{inDOM:function(){return jQuery.contains(document,this[0])}});var d=null,e,l=0;k.guid=function(){var a=(new Date).getTime().toString(32),b;for(b=0;5>b;b++)a+=Math.floor(65535*Math.random()).toString(32);return"p"+a+(l++).toString(32)};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;b.extend(b,{recorder:{supported:!1}});b.fn.recorder=function(a){var c=
this;b.extend(this,b.fn.recorder.prototype);this.options=b.extend(!0,{constraints:{video:{width:1280,height:720},audio:!1},flash:{swf_url:"WebcamRecorder.swf"},html5:{},autostart:!1},a);this.on("recorder:create",function(a,h){c.element||(c.element=h,b(h).appendTo(c).get(0))});this.create();return this};b.extend(b.fn.recorder.prototype,{element:null,state:!1,create:function(){},start:function(){},stop:function(){},snapshot:function(){}});var g={html5:{supported:!(!window.URL||!window.URL.createObjectURL)&&
function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}()&&!!navigator.mediaDevices&&!!navigator.mediaDevices.getUserMedia,create:function(){var a=this,c="html5-webcam-recorder-"+window.guid(),c='<video class="webcam-recorder" '+(a.options.height&&a.options.width?'width="'+a.options.width+'" height="'+a.options.height+'"':"")+' id="'+c+'" autoplay="autoplay"></video>';this.trigger(b.Event("recorder:create"),b(c).get(0));setTimeout(function(){a.trigger(b.Event("recorder:state:ready"),
a.element,"ready")},20)},start:function(){var a=this;navigator.mediaDevices.getUserMedia(this.options.constraints).then(function(c){void 0!==this.element.mozSrcObject?this.element.mozSrcObject=c:this.element.src=window.URL&&window.URL.createObjectURL(c)||c;d=c;b(this.element).on("playing",function(c){self.state="started";a.trigger(b.Event("recorder:state:started"),a.element)})}.bind(this))["catch"](function(c){a.state="error";1===c.code||"PermissionDeniedError"==c.name?a.trigger(b.Event("recorder:state:permissionerror"),
[a.element,c]):a.trigger(b.Event("recorder:state:error"),[a.element,c])});this.state="waiting";this.trigger(b.Event("recorder:state:waiting"),this.element)},stop:function(){var a,c;if(d)if(d.stop)d.stop();else if(d.getVideoTracks)for(c in a=d.getVideoTracks(),a)a[c].stop&&a[c].stop();b(this.element).off("playing");this.state="stopped";this.trigger(b.Event("recorder:state:stopped"),this.element)},snapshot:function(){var a,c;a=this.element.videoWidth||this.width();c=this.element.videoHeight||this.height();
if(d){var f=b('<canvas style="display:block"></canvas>').insertAfter(this).attr("width",a).attr("height",c);f.get(0).getContext("2d").drawImage(this.element,0,0,a,c);dataSrc=f.get(0).toDataURL("image/png");f.remove();return dataSrc}}},flash:{supported:swfobject&&swfobject.hasFlashPlayerVersion("11.2.0"),id:null,create:function(){var a=this;this.id="flash-webcam-recorder-"+window.guid();window.statechange=function(c){a.state=c;a.trigger(b.Event("recorder:state:"+c),a.element)};var c=b('<div><div id="'+
this.id+'" /></div>');a.trigger(b.Event("recorder:create"),c);var d=setInterval(function(){b("#"+a.id).inDOM()&&(swfobject.embedSWF(a.options.flash.swf_url,a.id,640,480,"11.2.0",!1,{},{allowscriptaccess:"always",wmode:"opaque"},{},function(b){b.success&&(a.element=b.ref)}),clearInterval(d))},100)},start:function(){var a=this;if("ready"==this.state||"error"==this.state||"permissionerror"==this.state)return ret=this.element.startcam();this.one("recorder:state:ready",function(b){b.stopPropagation();
a.start()})},stop:function(){try{return this.element.stopcam()}catch(a){}},snapshot:function(){return this.element.snapshot().split("\r").join("").split("\n").join("")}}};for(e in g)if(g[e].supported){b.extend(b.fn.recorder.prototype,g[e]);b.recorder.supported=!0;break}})(jQuery,window);
(function(b){(function(a,f){b.Event.call(this,a);this.dataurl=f;this.stopPropagation()}).prototype=new b.Event("");b.fn.extend({imagepastebox:function(a){var f=this,g={messages:{no_image_pasted:"No image data pasted.",no_processible_image_pasted:"Your Browser does not support pasting processible image data."}};if("off"==a)return this.off("paste").off("blur").off("keydown").prop("contenteditable",!1).blur();g=b.extend(a,g);this.on("paste",function(c){var d=c.clipboardData||c.originalEvent.clipboardData,
a=b(c.target),h,e,k=!1;h=function(c){var d=0,b,e;k=!0;b=setInterval(function(){var c=a.find("img");if(c.length||10<++d){clearInterval(b);k=!1;if(c.length)if(img=c.get(0),e=img.src,e.match(/^data:/))f.trigger("pasteimage",e);else{e.match(/^webkit-fake-url:/)?a.text(g.messages.no_processible_image_pasted):a.text(g.messages.no_image_pasted);return}a.html("")}},50)};d&&d.types&&d.types.length?b.each(d.types,function(b,a){if("Files"==a&&d.items)return e=d.items[b].getAsFile(),reader=new FileReader,reader.onload=
function(a){f.trigger("pasteimage",a.target.result)},reader.readAsDataURL(e),!1;e=d.getData(a);if(a.match(/image.*/))return h(c),!1;if(matches=e.match(/(^|src=")(data:.*)("|$)/))return f.trigger("pasteimage",matches[2]),!1;"text/html"==a&&(e.match(/<img/)?h(c):f.text(g.messages.no_image_pasted))}):h(c);k||c.preventDefault()}).prop("contenteditable",!0).on("keydown",function(a){b(this).text("")}).on("blur",function(a){var d=this;setTimeout(function(){b(d).focus()},10)});setTimeout(function(){f.focus()},
10);return this}})})(jQuery);
(function(d,e){var b=wp.media.view.l10n="undefined"===typeof _wpMediaViewsL10n?{}:_wpMediaViewsL10n,a=-1<navigator.userAgent.indexOf("Chrome"),f=!a&&-1<navigator.userAgent.indexOf("Safari"),b=_.extend(b,cheese_l10n),c={supports:{paste:!f&&cheese_l10n.enable_pasteboard&&("paste"in document||"onpaste"in document||"object"===typeof window.onpaste||"onpaste"in document.createElement("DIV")),webcam_recording:cheese_l10n.enable_snapshot&&d.recorder.supported&&(!a||a&&"https:"===location.protocol)},view:{},
wpUloader:!1,getWpUploader:function(){return c.wpUploader}};e.cheese=c})(jQuery,wp.media);
(function(d,e){var c=wp.media.view.l10n="undefined"===typeof _wpMediaViewsL10n?{}:_wpMediaViewsL10n;is_safari=!(-1<navigator.userAgent.indexOf("Chrome"))&&-1<navigator.userAgent.indexOf("Safari");d.extend(wp.Uploader.prototype,{success:function(a){}});_.extend(wp.media.view.MediaFrame.Select.prototype,{_parentInitialize:wp.media.view.MediaFrame.Select.prototype.initialize,initialize:function(){this._parentInitialize.apply(this,arguments);this.bindCheeseHandlers()},_parentBrowseRouter:wp.media.view.MediaFrame.Select.prototype.browseRouter,
browseRouter:function(a){this._parentBrowseRouter.apply(this,arguments);wp.media.cheese.supports.webcam_recording&&a.set({record:{text:c.webcam_record,priority:30}});wp.media.cheese.supports.paste&&a.set({pasteboard:{text:c.copy_paste,priority:35}})},bindCheeseHandlers:function(){var a=!1;this.on("content:render close",function(b){a&&"function"===typeof a.dismiss&&a.dismiss();"undefined"!==typeof b&&(a=b)},this);this.on("content:create:pasteboard",this.contentCreatePasteboard,this);this.on("content:create:record",
this.contentCreateRecord,this);this.on("content:render:pasteboard content:render:record",this.contentRenderGrabber,this);frame=this},contentCreateRecord:function(a){this.state();this.currentCheeseView=a.view=new wp.media.cheese.view.DataSourceImageGrabber({controller:this,grabber:wp.media.cheese.view.WebcamRecorder});this.listenTo(this.currentCheeseView.uploader,"action:uploaded:dataimage",this.uploadedDataImage)},contentCreatePasteboard:function(a){this.state();this.currentCheeseView=a.view=new wp.media.cheese.view.DataSourceImageGrabber({controller:this,
grabber:wp.media.cheese.view.Pasteboard});this.listenTo(this.currentCheeseView.uploader,"action:uploaded:dataimage",this.uploadedDataImage)},contentRenderGrabber:function(a){a.startGrabbing()},uploadedDataImage:function(a){console.log("uploaded!");this.stopListening(this.currentCheeseView.uploader,"action:uploaded:dataimage");a={view:null};this.browseContent(a);this.content.set(a.view);this.router.get().select("browse")}});_.extend(wp.media.view.AttachmentsBrowser.prototype,{_parentInitialize:wp.media.view.AttachmentsBrowser.prototype.initialize,
initialize:function(){var a=this,b;this._parentInitialize.apply(this,arguments);this.cheese={paste:{grabber:!1,modal:!1,mode:"paste"},record:{grabber:!1,modal:!1,mode:"record"},current:!1};this.controller instanceof wp.media.view.MediaFrame.Select||(wp.media.cheese.supports.paste&&(b=new wp.media.view.Button({text:c.copy_paste,className:"grabber-button",priority:-64,click:function(){a.cheese.active=a.cheese.paste;a.cheeseOpen(c.copy_paste)}}),this.cheese.paste.grabber=new wp.media.cheese.view.DataSourceImageGrabber({controller:this.controller,
grabber:wp.media.cheese.view.Pasteboard,wpuploader:this.controller.uploader.uploader.uploader}),this.toolbar.set("pasteModeButton",b.render())),wp.media.cheese.supports.webcam_recording&&(b=new wp.media.view.Button({text:c.take_snapshot,className:"grabber-button",priority:-65,click:function(){a.cheese.active=a.cheese.record;a.cheeseOpen(c.take_snapshot)}}),this.cheese.record.grabber=new wp.media.cheese.view.DataSourceImageGrabber({controller:this.controller,grabber:wp.media.cheese.view.WebcamRecorder,
wpuploader:this.controller.uploader.uploader.uploader}),this.toolbar.set("recordModeButton",b.render())))},cheeseUploaded:function(a){console.log("uploaded",a);this.cheese.active.grabber.dismiss();this.cheese.modal.close();this.cheeseClose()},cheeseError:function(a){console.log("error",a)},cheeseOpen:function(a){this.cheese.modal=new wp.media.view.Modal({controller:this,title:a});this.cheese.modal.content(this.cheese.active.grabber);this.cheese.modal.open();this.cheese.modal.on("close",this.cheeseClose,
this);this.cheese.active.grabber.startGrabbing();this.listenTo(this.cheese.active.grabber.uploader,"action:uploaded:dataimage",this.cheeseUploaded);this.listenTo(this.cheese.active.grabber.uploader,"error:uploaded:dataimage",this.cheeseError)},cheeseClose:function(){this.controller.deactivateMode(this.cheese.active.mode).activateMode("edit");this.stopListening(this.cheese.active.grabber.uploader,"action:uploaded:dataimage");this.stopListening(this.cheese.active.grabber.uploader,"error:uploaded:dataimage")}})})(jQuery,
window);
(function(c,f,g){f=wp.media.view.Button;var b=wp.media.view.l10n="undefined"===typeof _wpMediaViewsL10n?{}:_wpMediaViewsL10n,b=_.extend(b,cheese_l10n);wp.media.cheese.view.NameInput=wp.media.View.extend({tagName:"label",className:"setting",_input:null,initialize:function(){_.defaults(this.options,{defaultValue:"untitled",title:b.title});this._input=c('<input class="alignment" type="text" data-setting="title" />');this.$el.append("<span>"+this.options.title+"</span>").append(this._input)},render:function(){this._input.val()||
this._input.val(this.options.defaultValue)},val:function(){return this._input.val()||this.options.defaultValue}});wp.media.cheese.view.ActionButton=f.extend({dashicon:"yes",render:function(){_.defaults(this.options,{dashicon:"yes"});var a=wp.media.view.Button.prototype.render.apply(this,arguments);this.$el.addClass("button-action");this.$el.prepend('<span class="dashicons dashicons-'+this.options.dashicon+'"></span>');this.model.disabled?this.$el.addClass("disabled"):this.$el.removeClass("disabled");
return a}});wp.media.cheese.view.DataSourceImageUploader=wp.media.View.extend({tagName:"div",className:"data-source-image",controller:null,image:null,discardBtn:null,nameInput:null,uploadBtn:null,uploader:null,_model:{},initialize:function(){wp.media.View.prototype.initialize.apply(this,arguments);_.defaults(this.options,{defaultFileName:b.image});var a=this,d=new wp.media.View({tagName:"div",className:"instruments",controller:this.controller});this.uploader=this.options.uploder;this.discardBtn=new wp.media.cheese.view.ActionButton({className:"image-discard",
model:this.disabledModel,controller:this.controller,style:"secondary",text:b.try_again,dashicon:"arrow-left",click:function(){a.discardImage.apply(a,arguments)}});this.nameInput=new wp.media.cheese.view.NameInput({defaultValue:this.options.defaultFileName});this.uploadBtn=new wp.media.cheese.view.ActionButton({className:"image-upload",model:this.disabledModel,controller:this.controller,style:"primary",text:b.upload,click:function(){a.uploadImage.apply(a,arguments)}});this.views.add(d);d.views.add(this.discardBtn);
d.views.add(this.nameInput);d.views.add(this.uploadBtn);this.$imageContainer=!1},setImageData:function(a){var b=this.$el.find(".image-container").html("").get(0),h=this;this.image&&this.image.destroy();this.image=new g.Image;this.image.onload=function(){var a=h.getUploader().getOption("resize"),e=Math.max(a.width/this.width,a.height/this.height);a&&1>e&&this.downsize(this.width*e,this.height*e);this.embed(b)};this.image.bind("Resize",function(a){this.embed(b)});this.image.load(a);this.$imageContainer&&
this.$imageContainer.append(this.image);this.disabled(!1);return this},render:function(){this.$imageContainer=c('<span class="image-container" />');this.$el.prepend(this.$imageContainer)},discardImage:function(){this.trigger("action:discard:dataimage",this);this.unbindUploaderEvents()},uploadImage:function(){var a=this.nameInput.val()+".png",b=this.image.getAsBlob("image/png");this.bindUploaderEvents();b.detach(b.getSource());b.name=a;b.type="image/png";this.getUploader().addFile(b,a);this.disabled(!0);
this.trigger("action:upload:dataimage",this)},show:function(){this.$el.show();return this},hide:function(){this.$el.hide();return this},disabled:function(a){this.discardBtn.model.set("disabled",a);this.uploadBtn.model.set("disabled",a)},_uploadSuccessHandler:function(){this.trigger("action:uploaded:dataimage");this.disabled(!1);this.unbindUploaderEvents()},_uploadErrorHandler:function(){this.trigger("error:uploaded:dataimage");this.disabled(!1);this.unbindUploaderEvents()},bindUploaderEvents:function(){this.getUploader().bind("FileUploaded",
this._uploadSuccessHandler,this);this.getUploader().bind("Error",this._uploadErrorHandler,this)},unbindUploaderEvents:function(){this.getUploader().unbind("FileUploaded",this._uploadSuccessHandler,this);this.getUploader().unbind("Error",this._uploadErrorHandler,this)},getUploader:function(){return this.controller.uploader.uploader.uploader}});wp.media.cheese.view.WebcamRecorder=wp.media.View.extend({tagName:"div",className:"webcam-recorder",controller:null,action:"record",_webcam:null,_recorder:null,
_instruments:null,initialize:function(){_.defaults(this.options,{});var a=this;this._recorder=c('<div class="recorder"></div>').appendTo(this.$el).on("click",".recorder-record",function(b){b.preventDefault();a.trigger("action:create:dataimage",a,a._webcam.snapshot());a.stop();return!1});this._instruments=c('<div class="instruments"><a href="#" class="button recorder-record button-primary button-action"><span class="dashicons dashicons-video-alt2"></span>'+b.record+"</a></div>").appendTo(this._recorder);
this.$el.on("click",".error-try-again",function(){a.start();a.$el.find(".error").remove()});if(!this._webcam){var d={camera:{mandatory:{minWidth:640,minHeight:480}},microphone:!1,flash:{swf_url:b.swf_url}};this._webcam=c(this._recorder).recorder(d);this._webcam.on("recorder:state:ready",function(a){});this._webcam.on("recorder:state:waiting",function(b){a._instruments.hide()});this._webcam.on("recorder:state:started",function(b){a._instruments.show()});this._webcam.on("recorder:state:error",function(d){a.$el.append('<div class="error recorder-inline-content"><h3>'+
b.an_error_occured+'</h3><p><a class="error-try-again" href="#">'+b.try_again+"</a></p></div>");a._instruments.hide()});this._webcam.on("recorder:state:permissionerror",function(d,c,e){a.$el.append('<div class="error recorder-inline-content"><h3>'+(e.message||b.please_allow_camera_message)+'</h3><p><a class="error-try-again" href="#">'+b.try_again+"</a></p></div>");a._instruments.hide()});this._webcam.on("recorder:state:stopped",function(b){a._instruments.hide()})}this._instruments.hide()},get_state:function(){return this._webcam.state},
start:function(){this._recorder.is(":visible")||this._recorder.show();this._webcam.start();return this},stop:function(){this._webcam.stop();this._recorder.is(":visible")&&this._recorder.hide();return this},show:function(){this.$el.show();return this},hide:function(){this.$el.hide();return this}});wp.media.cheese.view.Pasteboard=wp.media.View.extend({tagName:"div",className:"pasteboard",controller:null,action:"paste",_content:null,_pasteboard:null,initialize:function(){_.defaults(this.options,{});
this._content=c('<div class="pasteboard-inline-content"><h3>'+b.paste_instructions+"</h3></div>").appendTo(this.$el);this._pasteboard=c('<div id="pasteboard-injector"></div>').appendTo(this._content)},start:function(){var a=this;this._pasteboard.imagepastebox({messages:{no_image_pasted:b.paste_error_no_image,no_processible_image_pasted:b.paste_error_webkit_fake_image}}).on("pasteimage",function(b,c){a._onPaste(c)}).focus();this.listenTo(this.pasteboard,"pasteimage",this._onPaste);return this},stop:function(){this._pasteboard.imagepastebox("off").off("pasteimage");
return this},show:function(){this.$el.show();return this},hide:function(){this.$el.hide();return this},_onPaste:function(a){this.trigger("action:create:dataimage",this,a)}});wp.media.cheese.view.DataSourceImageGrabber=wp.media.View.extend({tagName:"div",className:"image-grabber",grabber:null,uploader:null,initialize:function(){wp.media.View.prototype.initialize.apply(this,arguments);_.defaults(this.options,{wpuploader:null});var a=this.options.grabber==wp.media.cheese.view.WebcamRecorder?b.snapshot:
this.options.grabber==wp.media.cheese.view.Pasteboard?b.pasted:b.image,d=this.options.grabber==wp.media.cheese.view.WebcamRecorder?b.take_snapshot:this.options.grabber==wp.media.cheese.view.Pasteboard?b.copy_paste:b.image,c=new wp.media.View({className:"image-grabber-content",tagName:"div",controller:this.controller}),f=new wp.media.View({className:"media-frame-title",tagName:"div"}),e=new wp.media.View({tagName:"h1"});this.grabber=new this.options.grabber({controller:this.controller});this.uploader=
new wp.media.cheese.view.DataSourceImageUploader({controller:this.controller,uploder:this.options.wpuploader,defaultFileName:a});c.views.add(this.grabber);c.views.add(this.uploader);e.$el.text(d);f.views.add(e);this.views.add(f);this.views.add(c);this.listenTo(this.grabber,"action:create:dataimage",this.imageCreated);this.listenTo(this.uploader,"action:discard:dataimage",this.startGrabbing)},imageCreated:function(a,b){this.grabber.stop().hide();this.uploader.show().setImageData(b)},startGrabbing:function(){this.uploader.hide();
this.grabber.show().start();return this},getAction:function(){return this.grabber.action},dismiss:function(){this.grabber.stop();return this}})})(jQuery,window,mOxie);
