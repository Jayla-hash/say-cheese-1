(function(x){"object"===typeof exports&&"undefined"!==typeof module?module.exports=x():"function"===typeof define&&define.amd?define([],x):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=x()})(function(){return function e(k,n,d){function b(c,f){if(!n[c]){if(!k[c]){var h="function"==typeof require&&require;if(!f&&h)return h(c,!0);if(a)return a(c,!0);h=Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h;}h=n[c]={exports:{}};
k[c][0].call(h.exports,function(a){var f=k[c][1][a];return b(f?f:a)},h,h.exports,e,k,n,d)}return n[c].exports}for(var a="function"==typeof require&&require,c=0;c<d.length;c++)b(d[c]);return b}({1:[function(e,k,n){n=e("./utils").log;var d=e("./utils").browserDetails;k.exports.browserDetails=d;k.exports.extractVersion=e("./utils").extractVersion;k.exports.disableLog=e("./utils").disableLog;d.version<d.minVersion&&n("Browser: "+d.browser+" Version: "+d.version+" < minimum supported version: "+d.minVersion+
"\n some things might not work!");var b=e("./chrome/chrome_shim")||null,a=e("./edge/edge_shim")||null;e=e("./firefox/firefox_shim")||null;switch(d.browser){case "chrome":if(!b){n("Chrome shim is not included in this adapter release.");break}n("Adapter.js shimming chrome!");k.exports.browserShim=b;b.shimGetUserMedia();b.shimSourceObject();b.shimPeerConnection();b.shimOnTrack();break;case "edge":if(!a){n("MS edge shim is not included in this adapter release.");break}n("Adapter.js shimming edge!");k.exports.browserShim=
a;a.shimPeerConnection();break;case "firefox":if(!e){n("Firefox shim is not included in this adapter release.");break}n("Adapter.js shimming firefox!");k.exports.browserShim=e;e.shimGetUserMedia();e.shimSourceObject();e.shimPeerConnection();e.shimOnTrack();break;default:n("Unsupported browser!")}},{"./chrome/chrome_shim":2,"./edge/edge_shim":4,"./firefox/firefox_shim":5,"./utils":6}],2:[function(e,k,n){var d=e("../utils.js").log,b=e("../utils.js").browserDetails;k.exports={shimOnTrack:function(){"object"!==
typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){var c=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.addEventListener("addtrack",function(b){var h=
new Event("track");h.track=b.track;h.receiver={track:b.track};h.streams=[a.stream];c.dispatchEvent(h)});a.stream.getTracks().forEach(function(c){var b=new Event("track");b.track=c;b.receiver={track:c};b.streams=[a.stream];this.dispatchEvent(b)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"===typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},
set:function(a){this._srcObject=a;this.src&&URL.revokeObjectURL(this.src);this.src=URL.createObjectURL(a);a.addEventListener("addtrack",function(){self.src&&URL.revokeObjectURL(self.src);self.src=URL.createObjectURL(a)});a.addEventListener("removetrack",function(){self.src&&URL.revokeObjectURL(self.src);self.src=URL.createObjectURL(a)})}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(a,c){d("PeerConnection");a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);var b=
new webkitRTCPeerConnection(a,c),f=b.getStats.bind(b);b.getStats=function(a,c,b){var g=this,d=arguments;if(0<arguments.length&&"function"===typeof a)return f(a,c);var r=function(a){var c={};a.result().forEach(function(a){var b={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(c){b[c]=a.stat(c)});c[b.id]=b});return c};return 2<=arguments.length?f.apply(this,[function(a){d[1](r(a))},arguments[0]]):new Promise(function(c,b){1===d.length&&null===a?f.apply(g,[function(a){c.apply(null,
[r(a)])},b]):f.apply(g,[c,b])})};return b};window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype;webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?webkitRTCPeerConnection.generateCertificate.apply(null,arguments):webkitRTCPeerConnection.generateCertificate}});["createOffer","createAnswer"].forEach(function(a){var c=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=
function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,l){c.apply(a,[d,l,b])})}return c.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var c=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,b=this;return new Promise(function(d,l){c.apply(b,[a[0],function(){d();2<=a.length&&
a[1].apply(null,[])},function(c){l(c);3<=a.length&&a[2].apply(null,[c])}])})}})},shimGetUserMedia:function(){var a=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;var c={};Object.keys(a).forEach(function(b){if("require"!==b&&"advanced"!==b&&"mediaSource"!==b){var g="object"===typeof a[b]?a[b]:{ideal:a[b]};void 0!==g.exact&&"number"===typeof g.exact&&(g.min=g.max=g.exact);var d=function(a,c){return a?a+c.charAt(0).toUpperCase()+c.slice(1):"deviceId"===c?"sourceId":c};if(void 0!==
g.ideal){c.optional=c.optional||[];var p={};"number"===typeof g.ideal?(p[d("min",b)]=g.ideal,c.optional.push(p),p={},p[d("max",b)]=g.ideal):p[d("",b)]=g.ideal;c.optional.push(p)}void 0!==g.exact&&"number"!==typeof g.exact?(c.mandatory=c.mandatory||{},c.mandatory[d("",b)]=g.exact):["min","max"].forEach(function(a){void 0!==g[a]&&(c.mandatory=c.mandatory||{},c.mandatory[d(a,b)]=g[a])})}});a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced));return c};navigator.getUserMedia=function(c,b,g){c.audio&&
(c.audio=a(c.audio));c.video&&(c.video=a(c.video));d("chrome: "+JSON.stringify(c));return navigator.webkitGetUserMedia(c,b,g)};var c=function(a){return new Promise(function(c,b){navigator.getUserMedia(a,c,b)})};navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(a){var c={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(b){a(b.map(function(a){return{label:a.label,kind:c[a.kind],deviceId:a.id,groupId:""}}))})})}});
if(navigator.mediaDevices.getUserMedia){var b=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){c&&(d("spec:   "+JSON.stringify(c)),c.audio=a(c.audio),c.video=a(c.video),d("chrome: "+JSON.stringify(c)));return b(c)}.bind(this)}else navigator.mediaDevices.getUserMedia=function(a){return c(a)};"undefined"===typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){d("Dummy mediaDevices.addEventListener called.")});
"undefined"===typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){d("Dummy mediaDevices.removeEventListener called.")})},attachMediaStream:function(a,c){d("DEPRECATED, attachMediaStream will soon be removed.");43<=b.version?a.srcObject=c:"undefined"!==typeof a.src?a.src=URL.createObjectURL(c):d("Error attaching stream to element.")},reattachMediaStream:function(a,c){d("DEPRECATED, reattachMediaStream will soon be removed.");43<=b.version?a.srcObject=
c.srcObject:a.src=c.src}}},{"../utils.js":6}],3:[function(e,k,n){var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier();d.splitLines=function(b){return b.trim().split("\n").map(function(a){return a.trim()})};d.splitSections=function(b){return b.split("\r\nm=").map(function(a,c){return(0<c?"m="+a:a).trim()+"\r\n"})};d.matchPrefix=function(b,a){return d.splitLines(b).filter(function(c){return 0===c.indexOf(a)})};d.parseCandidate=function(b){b=
0===b.indexOf("a=candidate:")?b.substring(12).split(" "):b.substring(10).split(" ");for(var a={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]},c=8;c<b.length;c+=2)switch(b[c]){case "raddr":a.relatedAddress=b[c+1];break;case "rport":a.relatedPort=parseInt(b[c+1],10);break;case "tcptype":a.tcpType=b[c+1]}return a};d.writeCandidate=function(b){var a=[];a.push(b.foundation);a.push(b.component);a.push(b.protocol.toUpperCase());
a.push(b.priority);a.push(b.ip);a.push(b.port);var c=b.type;a.push("typ");a.push(c);"host"!==c&&b.relatedAddress&&b.relatedPort&&(a.push("raddr"),a.push(b.relatedAddress),a.push("rport"),a.push(b.relatedPort));b.tcpType&&"tcp"===b.protocol.toLowerCase()&&(a.push("tcptype"),a.push(b.tcpType));return"candidate:"+a.join(" ")};d.parseRtpMap=function(b){b=b.substr(9).split(" ");var a={payloadType:parseInt(b.shift(),10)};b=b[0].split("/");a.name=b[0];a.clockRate=parseInt(b[1],10);a.numChannels=3===b.length?
parseInt(b[2],10):1;return a};d.writeRtpMap=function(b){var a=b.payloadType;void 0!==b.preferredPayloadType&&(a=b.preferredPayloadType);return"a=rtpmap:"+a+" "+b.name+"/"+b.clockRate+(1!==b.numChannels?"/"+b.numChannels:"")+"\r\n"};d.parseFmtp=function(b){for(var a={},c=b.substr(b.indexOf(" ")+1).split(";"),g=0;g<c.length;g++)b=c[g].trim().split("="),a[b[0].trim()]=b[1];return a};d.writeFtmp=function(b){var a="",c=b.payloadType;void 0!==b.preferredPayloadType&&(c=b.preferredPayloadType);if(b.parameters&&
b.parameters.length){var g=[];Object.keys(b.parameters).forEach(function(a){g.push(a+"="+b.parameters[a])});a+="a=fmtp:"+c+" "+g.join(";")+"\r\n"}return a};d.parseRtcpFb=function(b){b=b.substr(b.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}};d.writeRtcpFb=function(b){var a="",c=b.payloadType;void 0!==b.preferredPayloadType&&(c=b.preferredPayloadType);b.rtcpFeedback&&b.rtcpFeedback.length&&b.rtcpFeedback.forEach(function(b){a+="a=rtcp-fb:"+c+" "+b.type+" "+b.parameter+"\r\n"});
return a};d.parseSsrcMedia=function(b){var a=b.indexOf(" "),c={ssrc:b.substr(7,a-7)},g=b.indexOf(":",a);-1<g?(c.attribute=b.substr(a+1,g-a-1),c.value=b.substr(g+1)):c.attribute=b.substr(a+1);return c};d.getDtlsParameters=function(b,a){var c=d.splitLines(b),c=c.concat(d.splitLines(a)),c=c.filter(function(a){return 0===a.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:c.split(" ")[0],value:c.split(" ")[1]}]}};d.writeDtlsParameters=function(b,a){var c="a=setup:"+
a+"\r\n";b.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"});return c};d.getIceParameters=function(b,a){var c=d.splitLines(b),c=c.concat(d.splitLines(a));return{usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)}};d.writeIceParameters=function(b){return"a=ice-ufrag:"+b.usernameFragment+"\r\na=ice-pwd:"+b.password+"\r\n"};d.parseRtpParameters=
function(b){for(var a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(b)[0].split(" "),g=3;g<c.length;g++){var f=c[g],h=d.matchPrefix(b,"a=rtpmap:"+f+" ")[0];if(h){var h=d.parseRtpMap(h),l=d.matchPrefix(b,"a=fmtp:"+f+" ");h.parameters=l.length?d.parseFmtp(l[0]):{};h.rtcpFeedback=d.matchPrefix(b,"a=rtcp-fb:"+f+" ").map(d.parseRtcpFb);a.codecs.push(h)}}return a};d.writeRtpDescription=function(b,a){var c="",c=c+("m="+b+" "),c=c+(0<a.codecs.length?"9":"0"),c=c+" UDP/TLS/RTP/SAVPF ",
c=c+(a.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n"),c=c+"c=IN IP4 0.0.0.0\r\n",c=c+"a=rtcp:9 IN IP4 0.0.0.0\r\n";a.codecs.forEach(function(a){c+=d.writeRtpMap(a);c+=d.writeFtmp(a);c+=d.writeRtcpFb(a)});return c+="a=rtcp-mux\r\n"};d.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};d.writeMediaSection=function(b,a,c,g){a=d.writeRtpDescription(b.kind,
a);a+=d.writeIceParameters(b.iceGatherer.getLocalParameters());a+=d.writeDtlsParameters(b.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active");a+="a=mid:"+b.mid+"\r\n";a=b.rtpSender&&b.rtpReceiver?a+"a=sendrecv\r\n":b.rtpSender?a+"a=sendonly\r\n":b.rtpReceiver?a+"a=recvonly\r\n":a+"a=inactive\r\n";b.rtpSender&&(c="msid:"+g.id+" "+b.rtpSender.track.id+"\r\n",a=a+("a="+c)+("a=ssrc:"+b.sendSsrc+" "+c));return a+="a=ssrc:"+b.sendSsrc+" cname:"+d.localCName+"\r\n"};d.getDirection=function(b,
a){for(var c=d.splitLines(b),g=0;g<c.length;g++)switch(c[g]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return c[g].substr(2)}return a?d.getDirection(a):"sendrecv"};k.exports=d},{}],4:[function(e,k,n){var d=e("./edge_sdp"),b=e("../utils").log;e("../utils");k.exports={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a}),window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a}));
window.RTCPeerConnection=function(a){var c=this;this.ondatachannel=this.onnegotiationneeded=this.oniceconnectionstatechange=this.onsignalingstatechange=this.onremovestream=this.onaddstream=this.onicecandidate=null;this.localStreams=[];this.remoteStreams=[];this.getLocalStreams=function(){return c.localStreams};this.getRemoteStreams=function(){return c.remoteStreams};this.localDescription=new RTCSessionDescription({type:"",sdp:""});this.remoteDescription=new RTCSessionDescription({type:"",sdp:""});
this.signalingState="stable";this.iceConnectionState="new";this.iceOptions={gatherPolicy:"all",iceServers:[]};if(a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case "all":case "relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case "none":throw new TypeError('iceTransportPolicy "none" not supported');}a&&a.iceServers&&(this.iceOptions.iceServers=a.iceServers.filter(function(a){return a&&a.urls?(a.urls=a.urls.filter(function(a){return-1!==a.indexOf("transport=udp")})[0],!0):!1}));
this.transceivers=[];this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this;this._localIceCandidatesBuffer.forEach(function(c){if(null!==a.onicecandidate)a.onicecandidate(c)});this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype.addStream=function(a){this.localStreams.push(a.clone());this._maybeFireNegotiationNeeded()};window.RTCPeerConnection.prototype.removeStream=function(a){a=this.localStreams.indexOf(a);-1<a&&(this.localStreams.splice(a,
1),this._maybeFireNegotiationNeeded())};window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,c){var b={codecs:[],headerExtensions:[],fecMechanisms:[]};a.codecs.forEach(function(a){for(var d=0;d<c.codecs.length;d++){var l=c.codecs[d];if(a.name.toLowerCase()===l.name.toLowerCase()&&a.clockRate===l.clockRate&&a.numChannels===l.numChannels){b.codecs.push(l);break}}});a.headerExtensions.forEach(function(a){for(var d=0;d<c.headerExtensions.length;d++){var l=c.headerExtensions[d];if(a.uri===
l.uri){b.headerExtensions.push(l);break}}});return b};window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,c){var b=this,f=new RTCIceGatherer(b.iceOptions),h=new RTCIceTransport(f);f.onlocalcandidate=function(m){var l={};l.candidate={sdpMid:a,sdpMLineIndex:c};(m=m.candidate)&&0!==Object.keys(m).length?(m.component="RTCP"===h.component?2:1,l.candidate.candidate=d.writeCandidate(m)):(void 0===f.state&&(f.state="completed"),l.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates");
m=b.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});if(null!==b.onicecandidate)if(b.localDescription&&""===b.localDescription.type)b._localIceCandidatesBuffer.push(l),m&&b._localIceCandidatesBuffer.push({});else if(b.onicecandidate(l),m)b.onicecandidate({})};h.onicestatechange=function(){b._updateConnectionState()};var l=new RTCDtlsTransport(h);l.ondtlsstatechange=function(){b._updateConnectionState()};l.onerror=function(){l.state="failed";b._updateConnectionState()};
return{iceGatherer:f,iceTransport:h,dtlsTransport:l}};window.RTCPeerConnection.prototype._transceive=function(a,c,b){var f=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(f.encodings=[{ssrc:a.sendSsrc}],f.rtcp={cname:d.localCName,ssrc:a.recvSsrc},a.rtpSender.send(f));b&&a.rtpReceiver&&(f.encodings=[{ssrc:a.recvSsrc}],f.rtcp={cname:a.cname,ssrc:a.sendSsrc},a.rtpReceiver.receive(f))};window.RTCPeerConnection.prototype.setLocalDescription=function(a){var c=this;
if("offer"===a.type)this._pendingOffer&&(this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){var b=d.splitSections(c.remoteDescription.sdp),f=b.shift();b.forEach(function(a,b){var g=c.transceivers[b],h=g.iceGatherer,l=g.iceTransport,e=g.dtlsTransport,k=g.localCapabilities,n=g.remoteCapabilities;if("0"!==a.split("\n",1)[0].split(" ",2)[1]){var q=d.getIceParameters(a,f);l.start(h,q,"controlled");h=d.getDtlsParameters(a,f);e.start(h);e=c._getCommonCapabilities(k,
n);c._transceive(g,0<e.codecs.length,!1)}})}this.localDescription=a;switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}var h=1<arguments.length&&"function"===typeof arguments[1];if(h){var l=arguments[1];window.setTimeout(function(){l();c._emitBufferedCandidates()},0)}b=Promise.resolve();b.then(function(){h||window.setTimeout(c._emitBufferedCandidates.bind(c),
0)});return b};window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var c=this,b=new MediaStream,f=d.splitSections(a.sdp),h=f.shift();f.forEach(function(f,m){var e=d.splitLines(f)[0].substr(2).split(" "),p=e[0],r="0"===e[1],e=d.getDirection(f,h),k,n,z,v,q,u,w,A=d.parseRtpParameters(f),t,B;r||(t=d.getIceParameters(f,h),B=d.getDtlsParameters(f,h));k=d.matchPrefix(f,"a=mid:")[0].substr(6);var y;if(q=d.matchPrefix(f,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===
a.attribute})[0])u=parseInt(q.ssrc,10),y=q.value;"offer"===a.type?(t=c._createIceAndDtlsTransports(k,m),w=RTCRtpReceiver.getCapabilities(p),q=1001*(2*m+2),r=new RTCRtpReceiver(t.dtlsTransport,p),b.addTrack(r.track),0<c.localStreams.length&&c.localStreams[0].getTracks().length>=m&&(v=c.localStreams[0].getTracks()[m],v=new RTCRtpSender(v,t.dtlsTransport)),c.transceivers[m]={iceGatherer:t.iceGatherer,iceTransport:t.iceTransport,dtlsTransport:t.dtlsTransport,localCapabilities:w,remoteCapabilities:A,rtpSender:v,
rtpReceiver:r,kind:p,mid:k,cname:y,sendSsrc:q,recvSsrc:u},c._transceive(c.transceivers[m],!1,"sendrecv"===e||"sendonly"===e)):"answer"!==a.type||r||(p=c.transceivers[m],k=p.iceGatherer,n=p.iceTransport,z=p.dtlsTransport,v=p.rtpSender,r=p.rtpReceiver,q=p.sendSsrc,w=p.localCapabilities,c.transceivers[m].recvSsrc=u,c.transceivers[m].remoteCapabilities=A,c.transceivers[m].cname=y,n.start(k,t,"controlling"),z.start(B),c._transceive(p,"sendrecv"===e||"recvonly"===e,"sendrecv"===e||"sendonly"===e),!r||"sendrecv"!==
e&&"sendonly"!==e?delete p.rtpReceiver:b.addTrack(r.track))});this.remoteDescription=a;switch(a.type){case "offer":this._updateSignalingState("have-remote-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}window.setTimeout(function(){null!==c.onaddstream&&b.getTracks().length&&(c.remoteStreams.push(b),window.setTimeout(function(){c.onaddstream({stream:b})},0))},0);1<arguments.length&&"function"===typeof arguments[1]&&
window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._updateSignalingState("closed")};window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a;if(null!==this.onsignalingstatechange)this.onsignalingstatechange()};window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=
function(){if(null!==this.onnegotiationneeded)this.onnegotiationneeded()};window.RTCPeerConnection.prototype._updateConnectionState=function(){var a,c={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};this.transceivers.forEach(function(a){c[a.iceTransport.state]++;c[a.dtlsTransport.state]++});c.connected+=c.completed;a="new";if(0<c.failed)a="failed";else if(0<c.connecting||0<c.checking)a="connecting";else if(0<c.disconnected)a="disconnected";else if(0<c["new"])a="new";else if(0<
c.connecting||0<c.completed)a="connected";if(a!==this.iceConnectionState&&(this.iceConnectionState=a,null!==this.oniceconnectionstatechange))this.oniceconnectionstatechange()};window.RTCPeerConnection.prototype.createOffer=function(){var a=this;if(this._pendingOffer)throw Error("createOffer called while there is a pending offer.");var c;1===arguments.length&&"function"!==typeof arguments[0]?c=arguments[0]:3===arguments.length&&(c=arguments[2]);var b=[],f=0,h=0;this.localStreams.length&&(f=this.localStreams[0].getAudioTracks().length,
h=this.localStreams[0].getVideoTracks().length);if(c){if(c.mandatory||c.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==c.offerToReceiveAudio&&(f=c.offerToReceiveAudio);void 0!==c.offerToReceiveVideo&&(h=c.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){b.push({kind:a.kind,track:a,wantReceive:"audio"===a.kind?0<f:0<h});"audio"===a.kind?f--:"video"===a.kind&&h--});0<f||0<h;)0<f&&(b.push({kind:"audio",
wantReceive:!0}),f--),0<h&&(b.push({kind:"video",wantReceive:!0}),h--);var e=d.writeSessionBoilerplate(),m=[];b.forEach(function(c,b){var g=c.track,f=c.kind,h=d.generateIdentifier(),k=a._createIceAndDtlsTransports(h,b),n=RTCRtpSender.getCapabilities(f),q,u,w=1001*(2*b+1);g&&(q=new RTCRtpSender(g,k.dtlsTransport));c.wantReceive&&(u=new RTCRtpReceiver(k.dtlsTransport,f));m[b]={iceGatherer:k.iceGatherer,iceTransport:k.iceTransport,dtlsTransport:k.dtlsTransport,localCapabilities:n,remoteCapabilities:null,
rtpSender:q,rtpReceiver:u,kind:f,mid:h,sendSsrc:w,recvSsrc:null};g=m[b];e+=d.writeMediaSection(g,g.localCapabilities,"offer",a.localStreams[0])});this._pendingOffer=m;c=new RTCSessionDescription({type:"offer",sdp:e});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,c);return Promise.resolve(c)};window.RTCPeerConnection.prototype.createAnswer=function(){var a=this,c=d.writeSessionBoilerplate();this.transceivers.forEach(function(b){var g=a._getCommonCapabilities(b.localCapabilities,
b.remoteCapabilities);c+=d.writeMediaSection(b,g,"answer",a.localStreams[0])});var b=new RTCSessionDescription({type:"answer",sdp:c});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,b);return Promise.resolve(b)};window.RTCPeerConnection.prototype.addIceCandidate=function(a){var c=a.sdpMLineIndex;if(a.sdpMid)for(var b=0;b<this.transceivers.length;b++)if(this.transceivers[b].mid===a.sdpMid){c=b;break}if(c=this.transceivers[c]){b=0<Object.keys(a.candidate).length?
d.parseCandidate(a.candidate):{};if("tcp"===b.protocol&&0===b.port||"1"!==b.component)return;"endOfCandidates"===b.type&&(b={});c.iceTransport.addRemoteCandidate(b)}1<arguments.length&&"function"===typeof arguments[1]&&window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});
var b=1<arguments.length&&"function"===typeof arguments[1]&&arguments[1];return new Promise(function(d){var f={};Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){f[b]=a[b]})});b&&window.setTimeout(b,0,f);d(f)})})}},attachMediaStream:function(a,c){b("DEPRECATED, attachMediaStream will soon be removed.");a.srcObject=c},reattachMediaStream:function(a,c){b("DEPRECATED, reattachMediaStream will soon be removed.");a.srcObject=c.srcObject}}},{"../utils":6,"./edge_sdp":3}],
5:[function(e,k,n){var d=e("../utils").log,b=e("../utils").browserDetails;k.exports={shimOnTrack:function(){"object"!==typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",
this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var d=new Event("track");d.track=b;d.receiver={track:b};d.streams=[a.stream];this.dispatchEvent(d)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"===typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(){window.RTCPeerConnection||
(window.RTCPeerConnection=function(a,c){if(38>b.version&&a&&a.iceServers){for(var d=[],f=0;f<a.iceServers.length;f++){var h=a.iceServers[f];if(h.hasOwnProperty("urls"))for(var e=0;e<h.urls.length;e++){var m={url:h.urls[e]};0===h.urls[e].indexOf("turn")&&(m.username=h.username,m.credential=h.credential);d.push(m)}else d.push(a.iceServers[f])}a.iceServers=d}return new mozRTCPeerConnection(a,c)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&
Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?mozRTCPeerConnection.generateCertificate.apply(null,arguments):mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate)},shimGetUserMedia:function(){navigator.getUserMedia=function(a,c,h){var e=function(a){if("object"!==typeof a||a.require)return a;var b=[];Object.keys(a).forEach(function(c){if("require"!==
c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c);void 0!==d.exact&&("number"===typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact);if(void 0!==d.ideal){a.advanced=a.advanced||[];var g={};g[c]="number"===typeof d.ideal?{min:d.ideal,max:d.ideal}:d.ideal;a.advanced.push(g);delete d.ideal;Object.keys(d).length||delete a[c]}}});b.length&&(a.require=b);return a};38>b.version&&(d("spec: "+JSON.stringify(a)),
a.audio&&(a.audio=e(a.audio)),a.video&&(a.video=e(a.video)),d("ff37: "+JSON.stringify(a)));return navigator.mozGetUserMedia(a,c,h)};var a=function(a){return new Promise(function(b,c){navigator.getUserMedia(a,b,c)})};navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,addEventListener:function(){},removeEventListener:function(){}});navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",
label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};if(41>b.version){var c=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;})}}},attachMediaStream:function(a,b){d("DEPRECATED, attachMediaStream will soon be removed.");a.srcObject=b},reattachMediaStream:function(a,b){d("DEPRECATED, reattachMediaStream will soon be removed.");
a.srcObject=b.srcObject}}},{"../utils":6}],6:[function(e,k,n){var d=!1;e={disableLog:function(b){return"boolean"!==typeof b?Error("Argument type: "+typeof b+". Please use a boolean."):(d=b)?"adapter.js logging disabled":"adapter.js logging enabled"},log:function(){"object"!==typeof window||d||console.log.apply(console,arguments)},extractVersion:function(b,a,c){return(b=b.match(a))&&b.length>=c&&parseInt(b[c],10)},detectBrowser:function(){var b={browser:null,version:null,minVersion:null};if("undefined"===
typeof window||!window.navigator)return b.browser="Not a supported browser.",b;if(navigator.mozGetUserMedia)return b.browser="firefox",b.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),b.minVersion=31,b;if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection)return b.browser="chrome",b.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),b.minVersion=38,b;if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return b.browser=
"edge",b.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),b.minVersion=10547,b}};k.exports={log:e.log,disableLog:e.disableLog,browserDetails:e.detectBrowser(),extractVersion:e.extractVersion}},{}]},{},[1])(1)});
(function(a,k){a.fn.outerHTML||a.extend(a.fn,{outerHTML:function(){return a("<div>").append(this.clone()).html()}});a.fn.inDOM||a.extend(a.fn,{inDOM:function(){return jQuery.contains(document,this[0])}});var d=null,e,l=0;k.guid=function(){var b=(new Date).getTime().toString(32),a;for(a=0;5>a;a++)b+=Math.floor(65535*Math.random()).toString(32);return"p"+b+(l++).toString(32)};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;a.extend(a,{recorder:{supported:!1}});a.fn.recorder=function(b){var c=
this;a.extend(this,a.fn.recorder.prototype);this.options=a.extend(!0,{constraints:{video:{width:1280,height:720},audio:!1},flash:{swf_url:"WebcamRecorder.swf"},html5:{},autostart:!1},b);this.on("recorder:create",function(b,h){c.element||(c.element=h,a(h).appendTo(c).get(0))});this.create();return this};a.extend(a.fn.recorder.prototype,{element:null,state:!1,create:function(){},start:function(){},stop:function(){},snapshot:function(){}});var g={html5:{supported:!(!window.URL||!window.URL.createObjectURL)&&
function(){var b=document.createElement("canvas");return!(!b.getContext||!b.getContext("2d"))}()&&!!navigator.mediaDevices&&!!navigator.mediaDevices.getUserMedia,create:function(){var b=this,c="html5-webcam-recorder-"+window.guid(),c='<video class="webcam-recorder" width="'+b.options.width+'" height="'+b.options.height+'" id="'+c+'" autoplay="autoplay"></video>';this.trigger(a.Event("recorder:create"),a(c).get(0));setTimeout(function(){b.trigger(a.Event("recorder:state:ready"),b.element,"ready")},
20)},start:function(){var b=this;navigator.mediaDevices.getUserMedia(this.options.constraints).then(function(c){void 0!==this.element.mozSrcObject?this.element.mozSrcObject=c:this.element.src=window.URL&&window.URL.createObjectURL(c)||c;d=c;a(this.element).on("playing",function(c){self.state="started";b.trigger(a.Event("recorder:state:started"),b.element)})}.bind(this))["catch"](function(c){b.state="error";1===c.code||"PermissionDeniedError"==c.name?b.trigger(a.Event("recorder:state:permissionerror"),
[b.element,c]):b.trigger(a.Event("recorder:state:error"),[b.element,c])});this.state="waiting";this.trigger(a.Event("recorder:state:waiting"),this.element)},stop:function(){var b,c;if(d)if(d.stop)d.stop();else if(d.getVideoTracks)for(c in b=d.getVideoTracks(),b)b[c].stop&&b[c].stop();a(this.element).off("playing");this.state="stopped";this.trigger(a.Event("recorder:state:stopped"),this.element)},snapshot:function(){var b,c;b=this.element.videoWidth||this.width();c=this.element.videoHeight||this.height();
if(d){var f=a('<canvas style="display:block"></canvas>').insertAfter(this).attr("width",b).attr("height",c);f.get(0).getContext("2d").drawImage(this.element,0,0,b,c);dataSrc=f.get(0).toDataURL("image/png");f.remove();return dataSrc}}},flash:{supported:swfobject&&swfobject.hasFlashPlayerVersion("11.2.0"),id:null,create:function(){var b=this;this.id="flash-webcam-recorder-"+window.guid();window.statechange=function(c){b.state=c;b.trigger(a.Event("recorder:state:"+c),b.element)};var c=a('<div><div id="'+
this.id+'" /></div>');b.trigger(a.Event("recorder:create"),c);var d=setInterval(function(){a("#"+b.id).inDOM()&&(swfobject.embedSWF(b.options.flash.swf_url,b.id,640,480,"11.2.0",!1,{},{allowscriptaccess:"always",wmode:"opaque"},{},function(a){a.success&&(b.element=a.ref)}),clearInterval(d))},100)},start:function(){var b=this;if("ready"==this.state||"error"==this.state||"permissionerror"==this.state)return ret=this.element.startcam();this.one("recorder:state:ready",function(a){a.stopPropagation();
b.start()})},stop:function(){try{return this.element.stopcam()}catch(a){}},snapshot:function(){return this.element.snapshot().split("\r").join("").split("\n").join("")}}};for(e in g)if(g[e].supported){a.extend(a.fn.recorder.prototype,g[e]);a.recorder.supported=!0;break}})(jQuery,window);
(function(b){(function(a,f){b.Event.call(this,a);this.dataurl=f;this.stopPropagation()}).prototype=new b.Event("");b.fn.extend({imagepastebox:function(a){var f=this,g={messages:{no_image_pasted:"No image data pasted.",no_processible_image_pasted:"Your Browser does not support pasting processible image data."}};if("off"==a)return this.off("paste").off("blur").off("keydown").prop("contenteditable",!1).blur();g=b.extend(a,g);this.on("paste",function(c){var d=c.clipboardData||c.originalEvent.clipboardData,
a=b(c.target),h,e,k=!1;h=function(c){var b=0,d,e;k=!0;d=setInterval(function(){var c=a.find("img");if(c.length||10<++b){clearInterval(d);k=!1;if(c.length)if(img=c.get(0),e=img.src,e.match(/^data:/))f.trigger("pasteimage",e);else{e.match(/^webkit-fake-url:/)?a.text(g.messages.no_processible_image_pasted):a.text(g.messages.no_image_pasted);return}a.html("")}},50)};d.types.length?b.each(d.types,function(b,a){if("Files"==a&&d.items)return e=d.items[b].getAsFile(),reader=new FileReader,reader.onload=function(a){f.trigger("pasteimage",
a.target.result)},reader.readAsDataURL(e),!1;e=d.getData(a);if(a.match(/image.*/))return h(c),!1;if(matches=e.match(/(^|src=")(data:.*)("|$)/))return f.trigger("pasteimage",matches[2]),!1;"text/html"==a&&(e.match(/<img/)?h(c):f.text(g.messages.no_image_pasted))}):h(c);k||c.preventDefault()}).prop("contenteditable",!0).on("keydown",function(a){b(this).text("")}).on("blur",function(a){var d=this;setTimeout(function(){b(d).focus()},10)});setTimeout(function(){f.focus()},10);return this}})})(jQuery);
(function(a,b){var c=wp.media.view.l10n="undefined"===typeof _wpMediaViewsL10n?{}:_wpMediaViewsL10n;is_safari=!(-1<navigator.userAgent.indexOf("Chrome"))&&-1<navigator.userAgent.indexOf("Safari");_.extend(c,cheese_l10n);b.cheese={supports:{paste:!is_safari&&cheese_l10n.enable_pasteboard&&("paste"in document||"onpaste"in document||"object"===typeof window.onpaste),webcam_recording:cheese_l10n.enable_snapshot&&a.recorder.supported},view:{}}})(jQuery,wp.media);
(function(c,d){var b=wp.media.view.l10n="undefined"===typeof _wpMediaViewsL10n?{}:_wpMediaViewsL10n;is_safari=!(-1<navigator.userAgent.indexOf("Chrome"))&&-1<navigator.userAgent.indexOf("Safari");c.extend(wp.Uploader.prototype,{success:function(a){}});_.extend(wp.media.view.MediaFrame.Select.prototype,{_parentInitialize:wp.media.view.MediaFrame.Select.prototype.initialize,initialize:function(){this._parentInitialize.apply(this,arguments);this.bindCheeseHandlers()},_parentBrowseRouter:wp.media.view.MediaFrame.Select.prototype.browseRouter,
browseRouter:function(a){this._parentBrowseRouter.apply(this,arguments);wp.media.cheese.supports.webcam_recording&&a.set({record:{text:b.webcam_record,priority:30}});wp.media.cheese.supports.paste&&a.set({pasteboard:{text:b.copy_paste,priority:35}})},bindCheeseHandlers:function(){var a=!1;this.on("content:render close",function(b){a&&"function"===typeof a.dismiss&&a.dismiss();"undefined"!==typeof b&&(a=b)},this);this.on("content:create:pasteboard",this.contentCreatePasteboard,this);this.on("content:create:record",
this.contentCreateRecord,this);this.on("content:render:pasteboard content:render:record",this.contentRenderGrabber,this);this.on("action:uploaded:dataimage",this.uploadedDataImage,this);frame=this},contentCreateRecord:function(a){this.state();a.view=new wp.media.cheese.view.DataSourceImageGrabber({controller:this,grabber:wp.media.cheese.view.WebcamRecorder})},contentCreatePasteboard:function(a){this.state();a.view=new wp.media.cheese.view.DataSourceImageGrabber({controller:this,grabber:wp.media.cheese.view.Pasteboard})},
contentRenderGrabber:function(a){a.startGrabbing()},uploadedDataImage:function(a){a={view:null};this.browseContent(a);this.content.set(a.view);this.router.get().select("browse")}});_.extend(wp.media.view.AttachmentsBrowser.prototype,{_parentInitialize:wp.media.view.AttachmentsBrowser.prototype.initialize,initialize:function(){this._parentInitialize.apply(this,arguments);this.controller instanceof wp.media.view.MediaFrame.Select||(wp.media.cheese.supports.paste&&this.toolbar.set("pasteModeButton",
(new wp.media.cheese.view.GrabberButton({text:b.copy_paste,controller:this.controller,priority:-65,grabber:wp.media.cheese.view.Pasteboard})).render()),wp.media.cheese.supports.webcam_recording&&this.toolbar.set("recordModeButton",(new wp.media.cheese.view.GrabberButton({text:b.take_snapshot,controller:this.controller,priority:-64,grabber:wp.media.cheese.view.WebcamRecorder})).render()))}})})(jQuery,window);
(function(c,l,g){var e=wp.media.view.Button,h=wp.media.view.Modal,b=wp.media.view.l10n="undefined"===typeof _wpMediaViewsL10n?{}:_wpMediaViewsL10n,b=_.extend(b,cheese_l10n);wp.media.cheese.view.NameInput=wp.media.View.extend({tagName:"label",className:"setting",_input:null,initialize:function(){_.defaults(this.options,{defaultValue:"untitled",title:b.title});this._input=c('<input class="alignment" type="text" data-setting="title" />');this.$el.append("<span>"+this.options.title+"</span>").append(this._input)},
render:function(){this._input.val()||this._input.val(this.options.defaultValue)},val:function(){return this._input.val()||this.options.defaultValue}});wp.media.cheese.view.ActionButton=e.extend({dashicon:"yes",render:function(){_.defaults(this.options,{dashicon:"yes"});var a=wp.media.view.Button.prototype.render.apply(this,arguments);this.$el.addClass("button-action");this.$el.prepend('<span class="dashicons dashicons-'+this.options.dashicon+'"></span>');this.model.disabled?this.$el.addClass("disabled"):
this.$el.removeClass("disabled");return a}});wp.media.cheese.view.DataSourceImageUploader=wp.media.View.extend({tagName:"div",className:"data-source-image",controller:null,image:null,discardBtn:null,nameInput:null,uploadBtn:null,uploader:null,_model:{},initialize:function(){_.defaults(this.options,{defaultFileName:b.image});var a=this,d=new wp.media.View({tagName:"div",className:"instruments",controller:this.controller});this.discardBtn=new wp.media.cheese.view.ActionButton({className:"image-discard",
style:"secondary",text:b.try_again,dashicon:"arrow-left",controller:this.controller,click:function(){a.discardImage.apply(a,arguments)}});this.nameInput=new wp.media.cheese.view.NameInput({defaultValue:this.options.defaultFileName});this.uploadBtn=new wp.media.cheese.view.ActionButton({className:"image-upload",style:"primary",text:b.upload,controller:this.controller,click:function(){a.uploadImage.apply(a,arguments)}});this.views.add(d);d.views.add(this.discardBtn);d.views.add(this.nameInput);d.views.add(this.uploadBtn);
this.$imageContainer=!1},setImageData:function(a){var b=this.$el.find(".image-container").html("").get(0),k=this;this.image&&this.image.destroy();console.log(this.controller);this.image=new g.Image;this.image.onload=function(){var a=k.controller.uploader.uploader.uploader.getOption("resize"),c=Math.max(a.width/this.width,a.height/this.height);a&&1>c&&this.downsize(this.width*c,this.height*c);this.embed(b)};this.image.bind("Resize",function(a){this.embed(b)});this.image.load(a);this.$imageContainer&&
this.$imageContainer.append(this.image);this.disabled(!1);return this},render:function(){this.$imageContainer=c('<span class="image-container" />');this.$el.prepend(this.$imageContainer)},discardImage:function(){this.controller.trigger("action:discard:dataimage",this)},uploadImage:function(){this.bindEvents();var a=this.image.getAsBlob("image/png");a.detach(a.getSource());a.name=this.nameInput.val()+".png";a.type="image/png";this.controller.uploader.uploader.uploader.addFile(a,this.nameInput.val()+
".png");this.disabled(!0);this.controller.trigger("action:upload:dataimage",this)},show:function(){this.$el.show();return this},hide:function(){this.$el.hide();return this},disabled:function(a){this.uploadBtn.model.disabled=this.discardBtn.model.disabled=a;this.uploadBtn.render();this.discardBtn.render()},_uploadSuccessHandler:function(){this.controller.trigger("action:uploaded:dataimage");this.disabled(!1)},_uploadErrorHandler:function(){this.controller.trigger("error:uploaded:dataimage");this.disabled(!1)},
bindEvents:function(){this.controller.uploader.uploader.uploader.bind("FileUploaded",this._uploadSuccessHandler,this);this.controller.uploader.uploader.uploader.bind("Error",this._uploadErrorHandler,this)}});wp.media.cheese.view.WebcamRecorder=wp.media.View.extend({tagName:"div",className:"webcam-recorder",controller:null,action:"record",_webcam:null,_recorder:null,_instruments:null,initialize:function(){_.defaults(this.options,{});var a=this;this._recorder=c('<div class="recorder"></div>').appendTo(this.$el).on("click",
".recorder-record",function(b){b.preventDefault();a.controller.trigger("action:create:dataimage",a,a._webcam.snapshot());a.stop();return!1});this._instruments=c('<div class="instruments"><a href="#" class="button recorder-record button-primary button-action"><span class="dashicons dashicons-video-alt2"></span>'+b.record+"</a></div>").appendTo(this._recorder);this.$el.on("click",".error-try-again",function(){a.start();a.$el.find(".error").remove()});if(!this._webcam){var d={camera:{mandatory:{minWidth:640,
minHeight:480}},microphone:!1,flash:{swf_url:b.swf_url}};this._webcam=c(this._recorder).recorder(d);this._webcam.on("recorder:state:ready",function(a){});this._webcam.on("recorder:state:waiting",function(b){a._instruments.hide()});this._webcam.on("recorder:state:started",function(b){a._instruments.show()});this._webcam.on("recorder:state:error",function(d){a.$el.append('<div class="error recorder-inline-content"><h3>'+b.an_error_occured+'</h3><p><a class="error-try-again" href="#">'+b.try_again+"</a></p></div>");
a._instruments.hide()});this._webcam.on("recorder:state:permissionerror",function(d,c,e){a.$el.append('<div class="error recorder-inline-content"><h3>'+(e.message||b.please_allow_camera_message)+'</h3><p><a class="error-try-again" href="#">'+b.try_again+"</a></p></div>");a._instruments.hide()});this._webcam.on("recorder:state:stopped",function(b){a._instruments.hide()})}this._instruments.hide()},get_state:function(){return this._webcam.state},start:function(){this._recorder.is(":visible")||this._recorder.show();
this._webcam.start();return this},stop:function(){this._webcam.stop();this._recorder.is(":visible")&&this._recorder.hide();return this},show:function(){this.$el.show();return this},hide:function(){this.$el.hide();return this}});wp.media.cheese.view.Pasteboard=wp.media.View.extend({tagName:"div",className:"pasteboard",controller:null,action:"paste",_content:null,_pasteboard:null,initialize:function(){_.defaults(this.options,{});this._content=c('<div class="pasteboard-inline-content"><h3>'+b.paste_instructions+
"</h3></div>").appendTo(this.$el);this._pasteboard=c('<div id="pasteboard-injector"></div>').appendTo(this._content)},start:function(){var a=this;this._pasteboard.imagepastebox({messages:{no_image_pasted:b.paste_error_no_image,no_processible_image_pasted:b.paste_error_webkit_fake_image}}).on("pasteimage",function(b,c){a._onPaste(c)}).focus();this.listenTo(this.pasteboard,"pasteimage",this._onPaste);return this},stop:function(){this._pasteboard.imagepastebox("off").off("pasteimage");return this},show:function(){this.$el.show();
return this},hide:function(){this.$el.hide();return this},_onPaste:function(a){this.controller.trigger("action:create:dataimage",this,a)}});wp.media.cheese.view.DataSourceImageGrabber=wp.media.View.extend({tagName:"div",className:"image-grabber",_grabber:null,_uploader:null,initialize:function(){_.defaults(this.options,{grabber:wp.media.cheese.view.WebcamRecorder});var a=this.options.grabber==wp.media.cheese.view.WebcamRecorder?b.snapshot:this.options.grabber==wp.media.cheese.view.Pasteboard?b.pasted:
b.image,d=this.options.grabber==wp.media.cheese.view.WebcamRecorder?b.take_snapshot:this.options.grabber==wp.media.cheese.view.Pasteboard?b.copy_paste:b.image,c=new wp.media.View({className:"image-grabber-content",tagName:"div",controller:this.controller}),e=new wp.media.View({className:"media-frame-title",tagName:"div"}),f=new wp.media.View({tagName:"h1"});this._grabber=new this.options.grabber({controller:this.controller});this._uploader=new wp.media.cheese.view.DataSourceImageUploader({controller:this.controller,
defaultFileName:a});c.views.add(this._grabber);c.views.add(this._uploader);f.$el.text(d);e.views.add(f);this.views.add(e);this.views.add(c);this.controller.on("action:create:dataimage",this.imageCreated,this);this.controller.on("action:discard:dataimage",this.startGrabbing,this)},imageCreated:function(a,b){this._grabber.stop().hide();this._uploader.show().setImageData(b)},startGrabbing:function(){this._uploader.hide();this._grabber.show().start();return this},getAction:function(){return this._grabber.action},
dismiss:function(){this._grabber.stop();return this}});wp.media.cheese.view.GrabberButton=e.extend({className:"grabber-button",_grabber:null,_modal:null,initialize:function(a){e.prototype.initialize.apply(this,arguments);var b;_.defaults(this.options,{grabber:null,title:"Image Grabber"});this._grabber=new wp.media.cheese.view.DataSourceImageGrabber({controller:this.controller,grabber:this.options.grabber});this._modal=new h({controller:c(),title:this.options.title});this._modal.content(this._grabber);
b=this._grabber.getAction();this.controller.on(b+":activate "+b+":deactivate",this.toggleModeHandler,this);this.controller.on(b+":action:done",this.back,this);this.controller.on("action:uploaded:dataimage",this.uploadDone,this);this.controller.on("error:uploaded:dataimage",this.uploadDone,this);this._modal.on("close",this.back,this)},uploadDone:function(){this._modal.close()},back:function(){this._grabber.dismiss();this.controller.deactivateMode(this._grabber.getAction()).activateMode("edit")},click:function(){e.prototype.click.apply(this,
arguments);this.controller.isModeActive(this._grabber.getAction())||(this.controller.deactivateMode("edit").activateMode(this._grabber.getAction()),this._modal.open(),this._grabber.startGrabbing())}})})(jQuery,window,mOxie);
