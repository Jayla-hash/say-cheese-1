(function(){var t,e,n,r,a;t=window.jQuery,t.paste=function(t){var n;return"undefined"!=typeof console&&null!==console&&console.log("DEPRECATED: This method is deprecated. Please use $.fn.pastableNonInputable() instead."),n=e.mountNonInputable(t),n._container},t.fn.pastableNonInputable=function(){var n,r,a,o;for(o=this,r=0,a=o.length;r<a;r++)n=o[r],n._pastable||t(n).is("textarea, input:text, [contenteditable]")||(e.mountNonInputable(n),n._pastable=!0);return this},t.fn.pastableTextarea=function(){var n,r,a,o;for(o=this,r=0,a=o.length;r<a;r++)n=o[r],n._pastable||t(n).is(":not(textarea, input:text)")||(e.mountTextarea(n),n._pastable=!0);return this},t.fn.pastableContenteditable=function(){var n,r,a,o;for(o=this,r=0,a=o.length;r<a;r++)n=o[r],n._pastable||t(n).is(":not([contenteditable])")||(e.mountContenteditable(n),n._pastable=!0);return this},r=function(t,e){var n,r,a,o,i,u,s,l,c,f,g;if(null==e&&(e=512),!(l=t.match(/^data\:([^\;]+)\;base64\,(.+)$/)))return null;for(f=l,l=f[0],u=f[1],n=f[2],o=atob(n),a=[],c=0;c<o.length;){for(g=o.slice(c,c+e),i=new Array(g.length),s=0;s<g.length;)i[s]=g.charCodeAt(s),s++;r=new Uint8Array(i),a.push(r),c+=e}return new Blob(a,{type:u})},n=function(){return t(document.createElement("div")).attr("contenteditable",!0).attr("aria-hidden",!0).attr("tabindex",-1).css({width:1,height:1,position:"fixed",left:-100,overflow:"hidden"})},a=function(e,n){var r,a,o,i,u,s;return i=void 0,u=void 0,o=void 0,a=void 0,r=void 0,"area"===(s=e.nodeName.toLowerCase())?(i=e.parentNode,u=i.name,!(!e.href||!u||"map"!==i.nodeName.toLowerCase())&&(o=t("img[usemap='#"+u+"']"),o.length>0&&o.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(s)?(a=!e.disabled)&&(r=t(e).closest("fieldset")[0])&&(a=!r.disabled):a="a"===s?e.href||n:n,(a=a||t(e).is("[contenteditable]"))&&t(e).is(":visible"))},e=function(){function e(e,n){this._container=e,this._target=n,this._container=t(this._container),this._target=t(this._target).addClass("pastable"),this._container.on("paste",function(t){return function(e){var n,r,a,o,i,u,s,l,c,f,g,d,p;if(e.currentTarget!==e.target)return e.preventDefault();if(t._paste_event_fired=!0,null!=(null!=(c=e.originalEvent)?c.clipboardData:void 0))if(n=e.originalEvent.clipboardData,n.items)for(f=n.items,o=0,u=f.length;o<u;o++){if(a=f[o],a.type.match(/^image\//)){l=new FileReader,l.onload=function(e){return t._handleImage(e.target.result)};try{l.readAsDataURL(a.getAsFile())}catch(t){}e.preventDefault();break}"text/plain"===a.type&&a.getAsString(function(e){return t._target.trigger("pasteText",{text:e})})}else-1!==Array.prototype.indexOf.call(n.types,"text/plain")&&(p=n.getData("Text"),setTimeout(function(){return t._target.trigger("pasteText",{text:p})},1)),t._checkImagesInContainer(function(e){return t._handleImage(e)});if(n=window.clipboardData)if(null!=(g=p=n.getData("Text"))?g.length:void 0)setTimeout(function(){return t._target.trigger("pasteText",{text:p}),t._target.trigger("_pasteCheckContainerDone")},1);else{for(d=n.files,i=0,s=d.length;i<s;i++)r=d[i],t._handleImage(URL.createObjectURL(r));t._checkImagesInContainer(function(t){})}return null}}(this))}return e.prototype._target=null,e.prototype._container=null,e.mountNonInputable=function(r){var o;return o=new e(n().appendTo(r),r),t(r).on("click",function(t){return function(t){if(!a(t.target,!1))return o._container.focus()}}()),o._container.on("focus",function(e){return function(){return t(r).addClass("pastable-focus")}}()),o._container.on("blur",function(e){return function(){return t(r).removeClass("pastable-focus")}}())},e.mountTextarea=function(r){var a,o,i,u;return("undefined"!=typeof DataTransfer&&null!==DataTransfer?DataTransfer.prototype:void 0)&&(null!=(i=Object.getOwnPropertyDescriptor)&&null!=(u=i.call(Object,DataTransfer.prototype,"items"))?u.get:void 0)?this.mountContenteditable(r):(o=new e(n().insertBefore(r),r),a=!1,t(r).on("keyup",function(t){var e;return 17!==(e=t.keyCode)&&224!==e||(a=!1),null}),t(r).on("keydown",function(e){var n;return 17!==(n=e.keyCode)&&224!==n||(a=!0),null!=e.ctrlKey&&null!=e.metaKey&&(a=e.ctrlKey||e.metaKey),a&&86===e.keyCode&&(o._textarea_focus_stolen=!0,o._container.focus(),o._paste_event_fired=!1,setTimeout(function(e){return function(){if(!o._paste_event_fired)return t(r).focus(),o._textarea_focus_stolen=!1}}(),1)),null}),t(r).on("paste",function(t){return function(){}}()),t(r).on("focus",function(e){return function(){if(!o._textarea_focus_stolen)return t(r).addClass("pastable-focus")}}()),t(r).on("blur",function(e){return function(){if(!o._textarea_focus_stolen)return t(r).removeClass("pastable-focus")}}()),t(o._target).on("_pasteCheckContainerDone",function(e){return function(){return t(r).focus(),o._textarea_focus_stolen=!1}}()),t(o._target).on("pasteText",function(e){return function(e,n){var a,o,i;return i=t(r).prop("selectionStart"),o=t(r).prop("selectionEnd"),a=t(r).val(),t(r).val(""+a.slice(0,i)+n.text+a.slice(o)),t(r)[0].setSelectionRange(i+n.text.length,i+n.text.length),t(r).trigger("change")}}()))},e.mountContenteditable=function(n){return new e(n,n),t(n).on("focus",function(e){return function(){return t(n).addClass("pastable-focus")}}()),t(n).on("blur",function(e){return function(){return t(n).removeClass("pastable-focus")}}())},e.prototype._handleImage=function(t){var e;return t.match(/^webkit\-fake\-url\:\/\//)?this._target.trigger("pasteImageError",{message:"You are trying to paste an image in Safari, however we are unable to retieve its data."}):(this._target.trigger("pasteImageStart"),e=new Image,e.crossOrigin="anonymous",e.onload=function(t){return function(){var n,a,o,i;a=document.createElement("canvas"),a.width=e.width,a.height=e.height,o=a.getContext("2d"),o.drawImage(e,0,0,a.width,a.height),i=null;try{i=a.toDataURL("image/png"),n=r(i)}catch(t){}return i&&t._target.trigger("pasteImage",{blob:n,dataURL:i,width:e.width,height:e.height}),t._target.trigger("pasteImageEnd")}}(this),e.onerror=function(e){return function(){return e._target.trigger("pasteImageError",{message:"Failed to get image from: "+t,url:t}),e._target.trigger("pasteImageEnd")}}(this),e.src=t)},e.prototype._checkImagesInContainer=function(e){var n,r,a,o,i;for(i=Math.floor(1e3*Math.random()),o=this._container.find("img"),r=0,a=o.length;r<a;r++)n=o[r],n["_paste_marked_"+i]=!0;return setTimeout(function(r){return function(){var a,o,u;for(u=r._container.find("img"),a=0,o=u.length;a<o;a++)n=u[a],n["_paste_marked_"+i]||(e(n.src),t(n).remove());return r._target.trigger("_pasteCheckContainerDone")}}(this),1)},e}()}).call(this);
var cheesePluginCallback;!function(e){cheesePluginCallback=function(t){function a(e,t){var a=e.type,n=cheese.options.mime_types[a],o=cheese.l10n.pasted+"."+n,i=e.getAsBlob(a,cheese.options.jpeg_quality),d=function(){c.uploader.uploader.uploader.addFile(i),c.close()};i.detach(i.getSource()),i.name=o,i.type=a,c?(c.state().reset(),d()):(c=wp.media.editor.open(window.wpActiveEditor,{frame:"post",state:"insert",title:cheese.l10n.copy_paste,multiple:!1}),c.uploader.uploader&&c.uploader.uploader.ready?d():c.on("uploader:ready",d)),c.uploader.uploader.uploader.bind("UploadProgress",function(e){t.attr("data-progress",e.total.percent)}),c.uploader.uploader.uploader.bind("FileUploaded",function(e,a){t.replaceWith('<img class="alignnone wp-image-'+a.attachment.id+' size-full" src="'+a.attachment.changed.url+'" />')})}function n(){var n=d.apply(this,arguments);return"mcepastebin"===e(n).attr("id")&&e(n).pastableContenteditable().on("pasteImage",function(e,n){var o,i="__cheese_img_"+s++,d=new mOxie.Image,c='<div class="cheese-image-placeholder" id="'+i+'" contenteditable="false"></div>';d.onload=function(){this.embed(o[0]),a(d,o)},setTimeout(function(){d.load(n.dataURL)},10),t.insertContent(c),o=t.$("#"+i)}),n}function o(){d=t.dom.add,t.dom.add=n}var i,d,c,l=!1,s=0;t.addCommand("cmd_cheese",function(){l=!l,i.active(l)}),t.addButton("cheese",{icon:"cheese",tooltip:"",cmd:"cmd_cheese",onPostRender:function(){i=this}}),t.on("init",function(){o()}).on("BeforePastePreProcess",function(e){console.log(e)})},tinymce.PluginManager.add("cheese",cheesePluginCallback)}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhc3RlLmpzIiwiY2hlZXNlLXBsdWdpbi5qcyJdLCJuYW1lcyI6WyIkIiwiUGFzdGUiLCJjcmVhdGVIaWRkZW5FZGl0YWJsZSIsImRhdGFVUkx0b0Jsb2IiLCJpc0ZvY3VzYWJsZSIsIndpbmRvdyIsImpRdWVyeSIsInBhc3RlIiwicGFzdGVDb250YWluZXIiLCJwbSIsImNvbnNvbGUiLCJsb2ciLCJtb3VudE5vbklucHV0YWJsZSIsIl9jb250YWluZXIiLCJmbiIsInBhc3RhYmxlTm9uSW5wdXRhYmxlIiwiZWwiLCJqIiwibGVuIiwicmVmIiwidGhpcyIsImxlbmd0aCIsIl9wYXN0YWJsZSIsImlzIiwicGFzdGFibGVUZXh0YXJlYSIsIm1vdW50VGV4dGFyZWEiLCJwYXN0YWJsZUNvbnRlbnRlZGl0YWJsZSIsIm1vdW50Q29udGVudGVkaXRhYmxlIiwiZGF0YVVSTCIsInNsaWNlU2l6ZSIsImI2NERhdGEiLCJieXRlQXJyYXkiLCJieXRlQXJyYXlzIiwiYnl0ZUNoYXJhY3RlcnMiLCJieXRlTnVtYmVycyIsImNvbnRlbnRUeXBlIiwiaSIsIm0iLCJvZmZzZXQiLCJzbGljZSIsIm1hdGNoIiwiYXRvYiIsIkFycmF5IiwiY2hhckNvZGVBdCIsIlVpbnQ4QXJyYXkiLCJwdXNoIiwiQmxvYiIsInR5cGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJhdHRyIiwiY3NzIiwid2lkdGgiLCJoZWlnaHQiLCJwb3NpdGlvbiIsImxlZnQiLCJvdmVyZmxvdyIsImVsZW1lbnQiLCJoYXNUYWJpbmRleCIsImZpZWxkc2V0IiwiZm9jdXNhYmxlSWZWaXNpYmxlIiwiaW1nIiwibWFwIiwibWFwTmFtZSIsIm5vZGVOYW1lIiwidG9Mb3dlckNhc2UiLCJwYXJlbnROb2RlIiwibmFtZSIsImhyZWYiLCJ0ZXN0IiwiZGlzYWJsZWQiLCJjbG9zZXN0IiwiX3RhcmdldCIsImFkZENsYXNzIiwib24iLCJfdGhpcyIsImV2IiwiY2xpcGJvYXJkRGF0YSIsImZpbGUiLCJpdGVtIiwiayIsImxlbjEiLCJyZWFkZXIiLCJyZWYxIiwicmVmMiIsInJlZjMiLCJ0ZXh0IiwiY3VycmVudFRhcmdldCIsInRhcmdldCIsInByZXZlbnREZWZhdWx0IiwiX3Bhc3RlX2V2ZW50X2ZpcmVkIiwib3JpZ2luYWxFdmVudCIsIml0ZW1zIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImV2ZW50IiwiX2hhbmRsZUltYWdlIiwicmVzdWx0IiwicmVhZEFzRGF0YVVSTCIsImdldEFzRmlsZSIsImVycm9yIiwiZ2V0QXNTdHJpbmciLCJzdHJpbmciLCJ0cmlnZ2VyIiwicHJvdG90eXBlIiwiaW5kZXhPZiIsImNhbGwiLCJ0eXBlcyIsImdldERhdGEiLCJzZXRUaW1lb3V0IiwiX2NoZWNrSW1hZ2VzSW5Db250YWluZXIiLCJzcmMiLCJmaWxlcyIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIm5vbklucHV0YWJsZSIsImFwcGVuZFRvIiwiZm9jdXMiLCJyZW1vdmVDbGFzcyIsInRleHRhcmVhIiwiY3RsRG93biIsIkRhdGFUcmFuc2ZlciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImdldCIsImluc2VydEJlZm9yZSIsImtleUNvZGUiLCJjdHJsS2V5IiwibWV0YUtleSIsIl90ZXh0YXJlYV9mb2N1c19zdG9sZW4iLCJkYXRhIiwiY29udGVudCIsImN1ckVuZCIsImN1clN0YXJ0IiwicHJvcCIsInZhbCIsInNldFNlbGVjdGlvblJhbmdlIiwiY29udGVudGVkaXRhYmxlIiwibG9hZGVyIiwibWVzc2FnZSIsIkltYWdlIiwiY3Jvc3NPcmlnaW4iLCJibG9iIiwiY2FudmFzIiwiY3R4IiwiZ2V0Q29udGV4dCIsImRyYXdJbWFnZSIsInRvRGF0YVVSTCIsIm9uZXJyb3IiLCJ1cmwiLCJjYiIsInRpbWVzcGFuIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZmluZCIsInJlbW92ZSIsImNoZWVzZVBsdWdpbkNhbGxiYWNrIiwiZWRpdG9yIiwidXBsb2FkSW1hZ2UiLCJpbWFnZSIsIiRjb250YWluZXIiLCJzdWZmaXgiLCJjaGVlc2UiLCJvcHRpb25zIiwibWltZV90eXBlcyIsImwxMG4iLCJwYXN0ZWQiLCJnZXRBc0Jsb2IiLCJqcGVnX3F1YWxpdHkiLCJhZGRGaWxlIiwid29ya2Zsb3ciLCJ1cGxvYWRlciIsImNsb3NlIiwiZGV0YWNoIiwiZ2V0U291cmNlIiwic3RhdGUiLCJyZXNldCIsIndwIiwibWVkaWEiLCJvcGVuIiwid3BBY3RpdmVFZGl0b3IiLCJmcmFtZSIsInRpdGxlIiwiY29weV9wYXN0ZSIsIm11bHRpcGxlIiwicmVhZHkiLCJiaW5kIiwiZSIsInRvdGFsIiwicGVyY2VudCIsImFyZ3MiLCJyZXBsYWNlV2l0aCIsImF0dGFjaG1lbnQiLCJpZCIsImNoYW5nZWQiLCJkb21BZGQiLCJvcmlnRG9tQWRkIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJjb3VudGVyIiwibU94aWUiLCJpbWFnZUh0bWwiLCJlbWJlZCIsImxvYWQiLCJpbnNlcnRDb250ZW50Iiwic2V0dXBFZGl0b3JEb20iLCJkb20iLCJhZGQiLCJjaGVlc2VCdG4iLCJhY3RpdmUiLCJhZGRDb21tYW5kIiwiYWRkQnV0dG9uIiwiaWNvbiIsInRvb2x0aXAiLCJjbWQiLCJvblBvc3RSZW5kZXIiLCJ0aW55bWNlIiwiUGx1Z2luTWFuYWdlciJdLCJtYXBwaW5ncyI6IkNBUUEsV0FDRSxHQUFJQSxHQUFHQyxFQUFPQyxFQUFzQkMsRUFBZUMsQ0FFbkRKLEdBQUlLLE9BQU9DLE9BRVhOLEVBQUVPLE1BQVEsU0FBU0MsR0FDakIsR0FBSUMsRUFLSixPQUp1QixtQkFBWkMsVUFBdUMsT0FBWkEsU0FDcENBLFFBQVFDLElBQUksMEZBRWRGLEVBQUtSLEVBQU1XLGtCQUFrQkosR0FDdEJDLEVBQUdJLFlBR1piLEVBQUVjLEdBQUdDLHFCQUF1QixXQUMxQixHQUFJQyxHQUFJQyxFQUFHQyxFQUFLQyxDQUVoQixLQURBQSxFQUFNQyxLQUNESCxFQUFJLEVBQUdDLEVBQU1DLEVBQUlFLE9BQVFKLEVBQUlDLEVBQUtELElBQ3JDRCxFQUFL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R0FBSSxPQUFRLFdBQ1pvSSxNQUVBcEksR0FBRyx3QkFBd0IsU0FBU2tILEdBQ3BDbEwsUUFBUUMsSUFBSWlMLE1BS2Y2QixRQUFRQyxjQUFjVixJQUFLLFNBQVVuRCx1QkFFbEN2SiIsImZpbGUiOiJjaGVlc2UtcGx1Z2luLXdpdGgtc291cmNlbWFwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjEyLjdcblxuLypcbnBhc3RlLmpzIGlzIGFuIGludGVyZmFjZSB0byByZWFkIGRhdGEgKCB0ZXh0IC8gaW1hZ2UgKSBmcm9tIGNsaXBib2FyZCBpbiBkaWZmZXJlbnQgYnJvd3NlcnMuIEl0IGFsc28gY29udGFpbnMgc2V2ZXJhbCBoYWNrcy5cblxuaHR0cHM6Ly9naXRodWIuY29tL2xheWVyc3Nzcy9wYXN0ZS5qc1xuICovXG5cbihmdW5jdGlvbigpIHtcbiAgdmFyICQsIFBhc3RlLCBjcmVhdGVIaWRkZW5FZGl0YWJsZSwgZGF0YVVSTHRvQmxvYiwgaXNGb2N1c2FibGU7XG5cbiAgJCA9IHdpbmRvdy5qUXVlcnk7XG5cbiAgJC5wYXN0ZSA9IGZ1bmN0aW9uKHBhc3RlQ29udGFpbmVyKSB7XG4gICAgdmFyIHBtO1xuICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBjb25zb2xlICE9PSBudWxsKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkRFUFJFQ0FURUQ6IFRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgJC5mbi5wYXN0YWJsZU5vbklucHV0YWJsZSgpIGluc3RlYWQuXCIpO1xuICAgIH1cbiAgICBwbSA9IFBhc3RlLm1vdW50Tm9uSW5wdXRhYmxlKHBhc3RlQ29udGFpbmVyKTtcbiAgICByZXR1cm4gcG0uX2NvbnRhaW5lcjtcbiAgfTtcblxuICAkLmZuLnBhc3RhYmxlTm9uSW5wdXRhYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsLCBqLCBsZW4sIHJlZjtcbiAgICByZWYgPSB0aGlzO1xuICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgZWwgPSByZWZbal07XG4gICAgICBpZiAoZWwuX3Bhc3RhYmxlIHx8ICQoZWwpLmlzKCd0ZXh0YXJlYSwgaW5wdXQ6dGV4dCwgW2NvbnRlbnRlZGl0YWJsZV0nKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIFBhc3RlLm1vdW50Tm9uSW5wdXRhYmxlKGVsKTtcbiAgICAgIGVsLl9wYXN0YWJsZSA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gICQuZm4ucGFzdGFibGVUZXh0YXJlYSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbCwgaiwgbGVuLCByZWY7XG4gICAgcmVmID0gdGhpcztcbiAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgIGVsID0gcmVmW2pdO1xuICAgICAgaWYgKGVsLl9wYXN0YWJsZSB8fCAkKGVsKS5pcygnOm5vdCh0ZXh0YXJlYSwgaW5wdXQ6dGV4dCknKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIFBhc3RlLm1vdW50VGV4dGFyZWEoZWwpO1xuICAgICAgZWwuX3Bhc3RhYmxlID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgJC5mbi5wYXN0YWJsZUNvbnRlbnRlZGl0YWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbCwgaiwgbGVuLCByZWY7XG4gICAgcmVmID0gdGhpcztcbiAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgIGVsID0gcmVmW2pdO1xuICAgICAgaWYgKGVsLl9wYXN0YWJsZSB8fCAkKGVsKS5pcygnOm5vdChbY29udGVudGVkaXRhYmxlXSknKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIFBhc3RlLm1vdW50Q29udGVudGVkaXRhYmxlKGVsKTtcbiAgICAgIGVsLl9wYXN0YWJsZSA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIGRhdGFVUkx0b0Jsb2IgPSBmdW5jdGlvbihkYXRhVVJMLCBzbGljZVNpemUpIHtcbiAgICB2YXIgYjY0RGF0YSwgYnl0ZUFycmF5LCBieXRlQXJyYXlzLCBieXRlQ2hhcmFjdGVycywgYnl0ZU51bWJlcnMsIGNvbnRlbnRUeXBlLCBpLCBtLCBvZmZzZXQsIHJlZiwgc2xpY2U7XG4gICAgaWYgKHNsaWNlU2l6ZSA9PSBudWxsKSB7XG4gICAgICBzbGljZVNpemUgPSA1MTI7XG4gICAgfVxuICAgIGlmICghKG0gPSBkYXRhVVJMLm1hdGNoKC9eZGF0YVxcOihbXlxcO10rKVxcO2Jhc2U2NFxcLCguKykkLykpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmVmID0gbSwgbSA9IHJlZlswXSwgY29udGVudFR5cGUgPSByZWZbMV0sIGI2NERhdGEgPSByZWZbMl07XG4gICAgYnl0ZUNoYXJhY3RlcnMgPSBhdG9iKGI2NERhdGEpO1xuICAgIGJ5dGVBcnJheXMgPSBbXTtcbiAgICBvZmZzZXQgPSAwO1xuICAgIHdoaWxlIChvZmZzZXQgPCBieXRlQ2hhcmFjdGVycy5sZW5ndGgpIHtcbiAgICAgIHNsaWNlID0gYnl0ZUNoYXJhY3RlcnMuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBzbGljZVNpemUpO1xuICAgICAgYnl0ZU51bWJlcnMgPSBuZXcgQXJyYXkoc2xpY2UubGVuZ3RoKTtcbiAgICAgIGkgPSAwO1xuICAgICAgd2hpbGUgKGkgPCBzbGljZS5sZW5ndGgpIHtcbiAgICAgICAgYnl0ZU51bWJlcnNbaV0gPSBzbGljZS5jaGFyQ29kZUF0KGkpO1xuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgICBieXRlQXJyYXkgPSBuZXcgVWludDhBcnJheShieXRlTnVtYmVycyk7XG4gICAgICBieXRlQXJyYXlzLnB1c2goYnl0ZUFycmF5KTtcbiAgICAgIG9mZnNldCArPSBzbGljZVNpemU7XG4gICAgfVxuICAgIHJldHVybiBuZXcgQmxvYihieXRlQXJyYXlzLCB7XG4gICAgICB0eXBlOiBjb250ZW50VHlwZVxuICAgIH0pO1xuICB9O1xuXG4gIGNyZWF0ZUhpZGRlbkVkaXRhYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpLmF0dHIoJ2NvbnRlbnRlZGl0YWJsZScsIHRydWUpLmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSkuYXR0cigndGFiaW5kZXgnLCAtMSkuY3NzKHtcbiAgICAgIHdpZHRoOiAxLFxuICAgICAgaGVpZ2h0OiAxLFxuICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICBsZWZ0OiAtMTAwLFxuICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nXG4gICAgfSk7XG4gIH07XG5cbiAgaXNGb2N1c2FibGUgPSBmdW5jdGlvbihlbGVtZW50LCBoYXNUYWJpbmRleCkge1xuICAgIHZhciBmaWVsZHNldCwgZm9jdXNhYmxlSWZWaXNpYmxlLCBpbWcsIG1hcCwgbWFwTmFtZSwgbm9kZU5hbWU7XG4gICAgbWFwID0gdm9pZCAwO1xuICAgIG1hcE5hbWUgPSB2b2lkIDA7XG4gICAgaW1nID0gdm9pZCAwO1xuICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9IHZvaWQgMDtcbiAgICBmaWVsZHNldCA9IHZvaWQgMDtcbiAgICBub2RlTmFtZSA9IGVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoJ2FyZWEnID09PSBub2RlTmFtZSkge1xuICAgICAgbWFwID0gZWxlbWVudC5wYXJlbnROb2RlO1xuICAgICAgbWFwTmFtZSA9IG1hcC5uYW1lO1xuICAgICAgaWYgKCFlbGVtZW50LmhyZWYgfHwgIW1hcE5hbWUgfHwgbWFwLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICdtYXAnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGltZyA9ICQoJ2ltZ1t1c2VtYXA9XFwnIycgKyBtYXBOYW1lICsgJ1xcJ10nKTtcbiAgICAgIHJldHVybiBpbWcubGVuZ3RoID4gMCAmJiBpbWcuaXMoJzp2aXNpYmxlJyk7XG4gICAgfVxuICAgIGlmICgvXihpbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdCkkLy50ZXN0KG5vZGVOYW1lKSkge1xuICAgICAgZm9jdXNhYmxlSWZWaXNpYmxlID0gIWVsZW1lbnQuZGlzYWJsZWQ7XG4gICAgICBpZiAoZm9jdXNhYmxlSWZWaXNpYmxlKSB7XG4gICAgICAgIGZpZWxkc2V0ID0gJChlbGVtZW50KS5jbG9zZXN0KCdmaWVsZHNldCcpWzBdO1xuICAgICAgICBpZiAoZmllbGRzZXQpIHtcbiAgICAgICAgICBmb2N1c2FibGVJZlZpc2libGUgPSAhZmllbGRzZXQuZGlzYWJsZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCdhJyA9PT0gbm9kZU5hbWUpIHtcbiAgICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9IGVsZW1lbnQuaHJlZiB8fCBoYXNUYWJpbmRleDtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9jdXNhYmxlSWZWaXNpYmxlID0gaGFzVGFiaW5kZXg7XG4gICAgfVxuICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9IGZvY3VzYWJsZUlmVmlzaWJsZSB8fCAkKGVsZW1lbnQpLmlzKCdbY29udGVudGVkaXRhYmxlXScpO1xuICAgIHJldHVybiBmb2N1c2FibGVJZlZpc2libGUgJiYgJChlbGVtZW50KS5pcygnOnZpc2libGUnKTtcbiAgfTtcblxuICBQYXN0ZSA9IChmdW5jdGlvbigpIHtcbiAgICBQYXN0ZS5wcm90b3R5cGUuX3RhcmdldCA9IG51bGw7XG5cbiAgICBQYXN0ZS5wcm90b3R5cGUuX2NvbnRhaW5lciA9IG51bGw7XG5cbiAgICBQYXN0ZS5tb3VudE5vbklucHV0YWJsZSA9IGZ1bmN0aW9uKG5vbklucHV0YWJsZSkge1xuICAgICAgdmFyIHBhc3RlO1xuICAgICAgcGFzdGUgPSBuZXcgUGFzdGUoY3JlYXRlSGlkZGVuRWRpdGFibGUoKS5hcHBlbmRUbyhub25JbnB1dGFibGUpLCBub25JbnB1dGFibGUpO1xuICAgICAgJChub25JbnB1dGFibGUpLm9uKCdjbGljaycsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICBpZiAoIWlzRm9jdXNhYmxlKGV2LnRhcmdldCwgZmFsc2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFzdGUuX2NvbnRhaW5lci5mb2N1cygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHBhc3RlLl9jb250YWluZXIub24oJ2ZvY3VzJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gJChub25JbnB1dGFibGUpLmFkZENsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgcmV0dXJuIHBhc3RlLl9jb250YWluZXIub24oJ2JsdXInLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAkKG5vbklucHV0YWJsZSkucmVtb3ZlQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIFBhc3RlLm1vdW50VGV4dGFyZWEgPSBmdW5jdGlvbih0ZXh0YXJlYSkge1xuICAgICAgdmFyIGN0bERvd24sIHBhc3RlLCByZWYsIHJlZjE7XG4gICAgICBpZiAoKHR5cGVvZiBEYXRhVHJhbnNmZXIgIT09IFwidW5kZWZpbmVkXCIgJiYgRGF0YVRyYW5zZmVyICE9PSBudWxsID8gRGF0YVRyYW5zZmVyLnByb3RvdHlwZSA6IHZvaWQgMCkgJiYgKChyZWYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKSAhPSBudWxsID8gKHJlZjEgPSByZWYuY2FsbChPYmplY3QsIERhdGFUcmFuc2Zlci5wcm90b3R5cGUsICdpdGVtcycpKSAhPSBudWxsID8gcmVmMS5nZXQgOiB2b2lkIDAgOiB2b2lkIDApKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vdW50Q29udGVudGVkaXRhYmxlKHRleHRhcmVhKTtcbiAgICAgIH1cbiAgICAgIHBhc3RlID0gbmV3IFBhc3RlKGNyZWF0ZUhpZGRlbkVkaXRhYmxlKCkuaW5zZXJ0QmVmb3JlKHRleHRhcmVhKSwgdGV4dGFyZWEpO1xuICAgICAgY3RsRG93biA9IGZhbHNlO1xuICAgICAgJCh0ZXh0YXJlYSkub24oJ2tleXVwJywgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgdmFyIHJlZjI7XG4gICAgICAgIGlmICgocmVmMiA9IGV2LmtleUNvZGUpID09PSAxNyB8fCByZWYyID09PSAyMjQpIHtcbiAgICAgICAgICBjdGxEb3duID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9KTtcbiAgICAgICQodGV4dGFyZWEpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgdmFyIHJlZjI7XG4gICAgICAgIGlmICgocmVmMiA9IGV2LmtleUNvZGUpID09PSAxNyB8fCByZWYyID09PSAyMjQpIHtcbiAgICAgICAgICBjdGxEb3duID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKGV2LmN0cmxLZXkgIT0gbnVsbCkgJiYgKGV2Lm1ldGFLZXkgIT0gbnVsbCkpIHtcbiAgICAgICAgICBjdGxEb3duID0gZXYuY3RybEtleSB8fCBldi5tZXRhS2V5O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdGxEb3duICYmIGV2LmtleUNvZGUgPT09IDg2KSB7XG4gICAgICAgICAgcGFzdGUuX3RleHRhcmVhX2ZvY3VzX3N0b2xlbiA9IHRydWU7XG4gICAgICAgICAgcGFzdGUuX2NvbnRhaW5lci5mb2N1cygpO1xuICAgICAgICAgIHBhc3RlLl9wYXN0ZV9ldmVudF9maXJlZCA9IGZhbHNlO1xuICAgICAgICAgIHNldFRpbWVvdXQoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGlmICghcGFzdGUuX3Bhc3RlX2V2ZW50X2ZpcmVkKSB7XG4gICAgICAgICAgICAgICAgJCh0ZXh0YXJlYSkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFzdGUuX3RleHRhcmVhX2ZvY3VzX3N0b2xlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pKHRoaXMpLCAxKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0pO1xuICAgICAgJCh0ZXh0YXJlYSkub24oJ3Bhc3RlJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHt9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgJCh0ZXh0YXJlYSkub24oJ2ZvY3VzJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoIXBhc3RlLl90ZXh0YXJlYV9mb2N1c19zdG9sZW4pIHtcbiAgICAgICAgICAgIHJldHVybiAkKHRleHRhcmVhKS5hZGRDbGFzcygncGFzdGFibGUtZm9jdXMnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICAkKHRleHRhcmVhKS5vbignYmx1cicsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKCFwYXN0ZS5fdGV4dGFyZWFfZm9jdXNfc3RvbGVuKSB7XG4gICAgICAgICAgICByZXR1cm4gJCh0ZXh0YXJlYSkucmVtb3ZlQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgJChwYXN0ZS5fdGFyZ2V0KS5vbignX3Bhc3RlQ2hlY2tDb250YWluZXJEb25lJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkKHRleHRhcmVhKS5mb2N1cygpO1xuICAgICAgICAgIHJldHVybiBwYXN0ZS5fdGV4dGFyZWFfZm9jdXNfc3RvbGVuID0gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICByZXR1cm4gJChwYXN0ZS5fdGFyZ2V0KS5vbigncGFzdGVUZXh0JywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihldiwgZGF0YSkge1xuICAgICAgICAgIHZhciBjb250ZW50LCBjdXJFbmQsIGN1clN0YXJ0O1xuICAgICAgICAgIGN1clN0YXJ0ID0gJCh0ZXh0YXJlYSkucHJvcCgnc2VsZWN0aW9uU3RhcnQnKTtcbiAgICAgICAgICBjdXJFbmQgPSAkKHRleHRhcmVhKS5wcm9wKCdzZWxlY3Rpb25FbmQnKTtcbiAgICAgICAgICBjb250ZW50ID0gJCh0ZXh0YXJlYSkudmFsKCk7XG4gICAgICAgICAgJCh0ZXh0YXJlYSkudmFsKFwiXCIgKyBjb250ZW50LnNsaWNlKDAsIGN1clN0YXJ0KSArIGRhdGEudGV4dCArIGNvbnRlbnQuc2xpY2UoY3VyRW5kKSk7XG4gICAgICAgICAgJCh0ZXh0YXJlYSlbMF0uc2V0U2VsZWN0aW9uUmFuZ2UoY3VyU3RhcnQgKyBkYXRhLnRleHQubGVuZ3RoLCBjdXJTdGFydCArIGRhdGEudGV4dC5sZW5ndGgpO1xuICAgICAgICAgIHJldHVybiAkKHRleHRhcmVhKS50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgUGFzdGUubW91bnRDb250ZW50ZWRpdGFibGUgPSBmdW5jdGlvbihjb250ZW50ZWRpdGFibGUpIHtcbiAgICAgIHZhciBwYXN0ZTtcbiAgICAgIHBhc3RlID0gbmV3IFBhc3RlKGNvbnRlbnRlZGl0YWJsZSwgY29udGVudGVkaXRhYmxlKTtcbiAgICAgICQoY29udGVudGVkaXRhYmxlKS5vbignZm9jdXMnLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAkKGNvbnRlbnRlZGl0YWJsZSkuYWRkQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICByZXR1cm4gJChjb250ZW50ZWRpdGFibGUpLm9uKCdibHVyJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gJChjb250ZW50ZWRpdGFibGUpLnJlbW92ZUNsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBQYXN0ZShfY29udGFpbmVyLCBfdGFyZ2V0KSB7XG4gICAgICB0aGlzLl9jb250YWluZXIgPSBfY29udGFpbmVyO1xuICAgICAgdGhpcy5fdGFyZ2V0ID0gX3RhcmdldDtcbiAgICAgIHRoaXMuX2NvbnRhaW5lciA9ICQodGhpcy5fY29udGFpbmVyKTtcbiAgICAgIHRoaXMuX3RhcmdldCA9ICQodGhpcy5fdGFyZ2V0KS5hZGRDbGFzcygncGFzdGFibGUnKTtcbiAgICAgIHRoaXMuX2NvbnRhaW5lci5vbigncGFzdGUnLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICAgdmFyIGNsaXBib2FyZERhdGEsIGZpbGUsIGl0ZW0sIGosIGssIGxlbiwgbGVuMSwgcmVhZGVyLCByZWYsIHJlZjEsIHJlZjIsIHJlZjMsIHRleHQ7XG4gICAgICAgICAgaWYgKGV2LmN1cnJlbnRUYXJnZXQgIT09IGV2LnRhcmdldCkge1xuICAgICAgICAgICAgcmV0dXJuIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIF90aGlzLl9wYXN0ZV9ldmVudF9maXJlZCA9IHRydWU7XG4gICAgICAgICAgaWYgKCgocmVmID0gZXYub3JpZ2luYWxFdmVudCkgIT0gbnVsbCA/IHJlZi5jbGlwYm9hcmREYXRhIDogdm9pZCAwKSAhPSBudWxsKSB7XG4gICAgICAgICAgICBjbGlwYm9hcmREYXRhID0gZXYub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhO1xuICAgICAgICAgICAgaWYgKGNsaXBib2FyZERhdGEuaXRlbXMpIHtcbiAgICAgICAgICAgICAgcmVmMSA9IGNsaXBib2FyZERhdGEuaXRlbXM7XG4gICAgICAgICAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZjEubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpdGVtID0gcmVmMVtqXTtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlLm1hdGNoKC9eaW1hZ2VcXC8vKSkge1xuICAgICAgICAgICAgICAgICAgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX2hhbmRsZUltYWdlKGV2ZW50LnRhcmdldC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGl0ZW0uZ2V0QXNGaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHt9XG4gICAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09ICd0ZXh0L3BsYWluJykge1xuICAgICAgICAgICAgICAgICAgaXRlbS5nZXRBc1N0cmluZyhmdW5jdGlvbihzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVUZXh0Jywge1xuICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZ1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaWYgKC0xICE9PSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGNsaXBib2FyZERhdGEudHlwZXMsICd0ZXh0L3BsYWluJykpIHtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdUZXh0Jyk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlVGV4dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgX3RoaXMuX2NoZWNrSW1hZ2VzSW5Db250YWluZXIoZnVuY3Rpb24oc3JjKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9oYW5kbGVJbWFnZShzcmMpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGNsaXBib2FyZERhdGEgPSB3aW5kb3cuY2xpcGJvYXJkRGF0YSkge1xuICAgICAgICAgICAgaWYgKChyZWYyID0gKHRleHQgPSBjbGlwYm9hcmREYXRhLmdldERhdGEoJ1RleHQnKSkpICE9IG51bGwgPyByZWYyLmxlbmd0aCA6IHZvaWQgMCkge1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVUZXh0Jywge1xuICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ19wYXN0ZUNoZWNrQ29udGFpbmVyRG9uZScpO1xuICAgICAgICAgICAgICB9LCAxKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlZjMgPSBjbGlwYm9hcmREYXRhLmZpbGVzO1xuICAgICAgICAgICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMy5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgICAgICAgICBmaWxlID0gcmVmM1trXTtcbiAgICAgICAgICAgICAgICBfdGhpcy5faGFuZGxlSW1hZ2UoVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgX3RoaXMuX2NoZWNrSW1hZ2VzSW5Db250YWluZXIoZnVuY3Rpb24oc3JjKSB7fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH1cblxuICAgIFBhc3RlLnByb3RvdHlwZS5faGFuZGxlSW1hZ2UgPSBmdW5jdGlvbihzcmMpIHtcbiAgICAgIHZhciBsb2FkZXI7XG4gICAgICBpZiAoc3JjLm1hdGNoKC9ed2Via2l0XFwtZmFrZVxcLXVybFxcOlxcL1xcLy8pKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZUVycm9yJywge1xuICAgICAgICAgIG1lc3NhZ2U6IFwiWW91IGFyZSB0cnlpbmcgdG8gcGFzdGUgYW4gaW1hZ2UgaW4gU2FmYXJpLCBob3dldmVyIHdlIGFyZSB1bmFibGUgdG8gcmV0aWV2ZSBpdHMgZGF0YS5cIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlU3RhcnQnKTtcbiAgICAgIGxvYWRlciA9IG5ldyBJbWFnZSgpO1xuICAgICAgbG9hZGVyLmNyb3NzT3JpZ2luID0gXCJhbm9ueW1vdXNcIjtcbiAgICAgIGxvYWRlci5vbmxvYWQgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBibG9iLCBjYW52YXMsIGN0eCwgZGF0YVVSTDtcbiAgICAgICAgICBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgICBjYW52YXMud2lkdGggPSBsb2FkZXIud2lkdGg7XG4gICAgICAgICAgY2FudmFzLmhlaWdodCA9IGxvYWRlci5oZWlnaHQ7XG4gICAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgY3R4LmRyYXdJbWFnZShsb2FkZXIsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgICAgICAgZGF0YVVSTCA9IG51bGw7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGRhdGFVUkwgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTtcbiAgICAgICAgICAgIGJsb2IgPSBkYXRhVVJMdG9CbG9iKGRhdGFVUkwpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgIGlmIChkYXRhVVJMKSB7XG4gICAgICAgICAgICBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2UnLCB7XG4gICAgICAgICAgICAgIGJsb2I6IGJsb2IsXG4gICAgICAgICAgICAgIGRhdGFVUkw6IGRhdGFVUkwsXG4gICAgICAgICAgICAgIHdpZHRoOiBsb2FkZXIud2lkdGgsXG4gICAgICAgICAgICAgIGhlaWdodDogbG9hZGVyLmhlaWdodFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2VFbmQnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpO1xuICAgICAgbG9hZGVyLm9uZXJyb3IgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZUVycm9yJywge1xuICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gZ2V0IGltYWdlIGZyb206IFwiICsgc3JjLFxuICAgICAgICAgICAgdXJsOiBzcmNcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlRW5kJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKTtcbiAgICAgIHJldHVybiBsb2FkZXIuc3JjID0gc3JjO1xuICAgIH07XG5cbiAgICBQYXN0ZS5wcm90b3R5cGUuX2NoZWNrSW1hZ2VzSW5Db250YWluZXIgPSBmdW5jdGlvbihjYikge1xuICAgICAgdmFyIGltZywgaiwgbGVuLCByZWYsIHRpbWVzcGFuO1xuICAgICAgdGltZXNwYW4gPSBNYXRoLmZsb29yKDEwMDAgKiBNYXRoLnJhbmRvbSgpKTtcbiAgICAgIHJlZiA9IHRoaXMuX2NvbnRhaW5lci5maW5kKCdpbWcnKTtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICBpbWcgPSByZWZbal07XG4gICAgICAgIGltZ1tcIl9wYXN0ZV9tYXJrZWRfXCIgKyB0aW1lc3Bhbl0gPSB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNldFRpbWVvdXQoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgaywgbGVuMSwgcmVmMTtcbiAgICAgICAgICByZWYxID0gX3RoaXMuX2NvbnRhaW5lci5maW5kKCdpbWcnKTtcbiAgICAgICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgICAgIGltZyA9IHJlZjFba107XG4gICAgICAgICAgICBpZiAoIWltZ1tcIl9wYXN0ZV9tYXJrZWRfXCIgKyB0aW1lc3Bhbl0pIHtcbiAgICAgICAgICAgICAgY2IoaW1nLnNyYyk7XG4gICAgICAgICAgICAgICQoaW1nKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF90aGlzLl90YXJnZXQudHJpZ2dlcignX3Bhc3RlQ2hlY2tDb250YWluZXJEb25lJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSwgMSk7XG4gICAgfTtcblxuICAgIHJldHVybiBQYXN0ZTtcblxuICB9KSgpO1xuXG59KS5jYWxsKHRoaXMpO1xuIiwidmFyIGNoZWVzZVBsdWdpbkNhbGxiYWNrO1xuXG4oZnVuY3Rpb24oJCl7XG5cdGNoZWVzZVBsdWdpbkNhbGxiYWNrID0gZnVuY3Rpb24oIGVkaXRvciApIHtcblx0XHR2YXIgY2hlZXNlQnRuLCAkZG9jLCAkYm9keSwgcGFzdGViaW4sXG5cdFx0XHRhY3RpdmUgPSBmYWxzZSxcblx0XHRcdGNvdW50ZXIgPSAwLFxuXHRcdFx0b3JpZ0RvbUFkZCxcblx0XHRcdHdvcmtmbG93O1xuXG5cdFx0ZnVuY3Rpb24gdXBsb2FkSW1hZ2UoIGltYWdlLCAkY29udGFpbmVyICkge1xuXG5cdFx0XHR2YXIgdHlwZSA9IGltYWdlLnR5cGUsIFxuXHRcdFx0XHRzdWZmaXggPSBjaGVlc2Uub3B0aW9ucy5taW1lX3R5cGVzWyB0eXBlIF0sXG5cdFx0XHRcdG5hbWUgPSBjaGVlc2UubDEwbi5wYXN0ZWQgKyAnLicgKyBzdWZmaXgsXG5cdFx0XHRcdGJsb2IgPSBpbWFnZS5nZXRBc0Jsb2IoIHR5cGUsIGNoZWVzZS5vcHRpb25zLmpwZWdfcXVhbGl0eSApLFxuXHRcdFx0XHRhZGRGaWxlID0gZnVuY3Rpb24oKXtcblx0XHRcdFx0XHR3b3JrZmxvdy51cGxvYWRlci51cGxvYWRlci51cGxvYWRlci5hZGRGaWxlKCBibG9iICk7XG5cdFx0XHRcdFx0d29ya2Zsb3cuY2xvc2UoKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRcblx0XHRcdGJsb2IuZGV0YWNoKCBibG9iLmdldFNvdXJjZSgpICk7XG5cdFx0XHRibG9iLm5hbWUgPSBuYW1lO1xuXHRcdFx0YmxvYi50eXBlID0gdHlwZTtcblxuXHRcdFx0aWYgKCAhIHdvcmtmbG93ICkge1xuXHRcdFx0XHR3b3JrZmxvdyA9IHdwLm1lZGlhLmVkaXRvci5vcGVuKCB3aW5kb3cud3BBY3RpdmVFZGl0b3IsIHtcblx0XHRcdFx0XHRmcmFtZTpcdFx0J3Bvc3QnLFxuXHRcdFx0XHRcdHN0YXRlOlx0XHQnaW5zZXJ0Jyxcblx0XHRcdFx0XHR0aXRsZTpcdFx0Y2hlZXNlLmwxMG4uY29weV9wYXN0ZSxcblx0XHRcdFx0XHRtdWx0aXBsZTpcdGZhbHNlXG5cdFx0XHRcdH0gKTtcblx0XHRcdFx0aWYgKCB3b3JrZmxvdy51cGxvYWRlci51cGxvYWRlciAmJiB3b3JrZmxvdy51cGxvYWRlci51cGxvYWRlci5yZWFkeSApIHtcblx0XHRcdFx0XHRhZGRGaWxlKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0d29ya2Zsb3cub24oICd1cGxvYWRlcjpyZWFkeScsIGFkZEZpbGUgKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0d29ya2Zsb3cuc3RhdGUoKS5yZXNldCgpO1xuXHRcdFx0XHRhZGRGaWxlKCk7XG5cdFx0XHR9XG5cblx0XHRcdHdvcmtmbG93LnVwbG9hZGVyLnVwbG9hZGVyLnVwbG9hZGVyLmJpbmQoJ1VwbG9hZFByb2dyZXNzJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0JGNvbnRhaW5lci5hdHRyKCdkYXRhLXByb2dyZXNzJyxlLnRvdGFsLnBlcmNlbnQpO1xuXHRcdFx0fSk7XG5cdFx0XHR3b3JrZmxvdy51cGxvYWRlci51cGxvYWRlci51cGxvYWRlci5iaW5kKCdGaWxlVXBsb2FkZWQnLGZ1bmN0aW9uKGUsYXJncyl7XG5cblx0XHRcdFx0JGNvbnRhaW5lci5yZXBsYWNlV2l0aCggJzxpbWcgY2xhc3M9XCJhbGlnbm5vbmUgd3AtaW1hZ2UtJythcmdzLmF0dGFjaG1lbnQuaWQrJyBzaXplLWZ1bGxcIiBzcmM9XCInK2FyZ3MuYXR0YWNobWVudC5jaGFuZ2VkLnVybCsnXCIgLz4nICk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBkb21BZGQoKSB7XG5cdFx0XHR2YXIgcmVzdWx0ID0gb3JpZ0RvbUFkZC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0XHRpZiAoICdtY2VwYXN0ZWJpbicgPT09ICQocmVzdWx0KS5hdHRyKCdpZCcpICkge1xuXHRcdFx0XHQkKHJlc3VsdClcblx0XHRcdFx0XHQucGFzdGFibGVDb250ZW50ZWRpdGFibGUoKVxuXHRcdFx0XHRcdC5vbigncGFzdGVJbWFnZScsZnVuY3Rpb24oIGUsIGRhdGEgKSB7XG5cdFx0XHRcdFx0XHR2YXIgaWQgPSAnX19jaGVlc2VfaW1nXycrKGNvdW50ZXIrKyksXG5cdFx0XHRcdFx0XHRcdGltYWdlID0gbmV3IG1PeGllLkltYWdlKCksXG5cdFx0XHRcdFx0XHRcdGltYWdlSHRtbCA9ICc8ZGl2IGNsYXNzPVwiY2hlZXNlLWltYWdlLXBsYWNlaG9sZGVyXCIgaWQ9XCInK2lkKydcIiBjb250ZW50ZWRpdGFibGU9XCJmYWxzZVwiPjwvZGl2PicsXG5cdFx0XHRcdFx0XHRcdCRjb250YWluZXI7XG4vLyBcblx0XHRcdFx0XHRcdGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmVtYmVkKCRjb250YWluZXJbMF0pO1xuXHRcdFx0XHRcdFx0XHR1cGxvYWRJbWFnZSggaW1hZ2UsICRjb250YWluZXIgKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0XHRpbWFnZS5sb2FkKCBkYXRhLmRhdGFVUkwgKTtcblx0XHRcdFx0XHRcdH0sMTApO1xuXG5cdFx0XHRcdFx0XHRlZGl0b3IuaW5zZXJ0Q29udGVudCggaW1hZ2VIdG1sICk7XG5cdFx0XHRcdFx0XHQkY29udGFpbmVyID0gZWRpdG9yLiQoJyMnK2lkKTtcblxuXG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2V0dXBFZGl0b3JEb20oKSB7XG5cdFx0XHRvcmlnRG9tQWRkID0gZWRpdG9yLmRvbS5hZGQ7XG5cblx0XHRcdGVkaXRvci5kb20uYWRkID0gZG9tQWRkO1xuXHRcdH1cblx0XHRlZGl0b3IuYWRkQ29tbWFuZCggJ2NtZF9jaGVlc2UnLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBlZGl0b3JfYm9keTtcblxuXHRcdFx0YWN0aXZlID0gISBhY3RpdmU7XG5cdFx0XHRjaGVlc2VCdG4uYWN0aXZlKCBhY3RpdmUgKTtcblx0XHRcdFxuLy8gXHRcdFx0aWYgKCBhY3RpdmUgKSB7XG4vLyBcdFx0XHRcdCRib2R5Lm9uKCdwYXN0ZUltYWdlJyxmdW5jdGlvbigpe1xuLy8gXHRcdFx0XHRcdGNvbnNvbGUubG9nKGFyZ3VtZW50cyk7XG4vLyBcdFx0XHRcdH0pO1xuLy8gXHRcdFx0fSBlbHNlIHtcbi8vIFx0XHRcdFx0JGJvZHkub2ZmKCdwYXN0ZUltYWdlJyk7XG4vLyBcdFx0XHR9XG5cdFx0fSk7XG5cblxuXHRcdGVkaXRvci5hZGRCdXR0b24oJ2NoZWVzZScsIHtcblx0XHRcdGljb246ICdjaGVlc2UnLFxuXHRcdFx0dG9vbHRpcDogJycsXG5cdFx0XHRjbWQgOiAnY21kX2NoZWVzZScsXG5cdFx0XHRvblBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRjaGVlc2VCdG4gPSB0aGlzO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0ZWRpdG9yXG5cdFx0XHQub24oICdpbml0JywgZnVuY3Rpb24oKXtcblx0XHRcdFx0c2V0dXBFZGl0b3JEb20oKTtcblx0XHRcdH0pXG5cdFx0XHQub24oJ0JlZm9yZVBhc3RlUHJlUHJvY2VzcycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGUpO1xuXHRcdFx0fSk7XG5cblx0fTtcblxuXHR0aW55bWNlLlBsdWdpbk1hbmFnZXIuYWRkKCAnY2hlZXNlJywgY2hlZXNlUGx1Z2luQ2FsbGJhY2sgKTtcblxufSApKGpRdWVyeSk7XG5cbiJdfQ==
